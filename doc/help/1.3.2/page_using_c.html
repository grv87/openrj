<head>
 <link href="openrj.css" rel="stylesheet" type="text/css">
</head>

<table width = "100%" cellspacing = "0" cellpadding = "0">
 <tr bgcolor="#333366">
  <td align = "center" valign = "middle">
   <a href = "http://openrj.org"><img src = "openrj_logo_small.jpg" border = "0" alt = "Open-RJ" /></a>
  </td>
  <td align = "center" valign = "middle">
   <a href = "http://www.cuj.com/"><img src = "cuj_logo.gif" border = "0" width = "155" height = "50" alt = "C/C++ User's Journal" /></a>
  </td>
  <td align = "center" valign = "middle">
   <a href = "http://www.synesis.com.au/"><img src = "syn_head.jpg" border = "0" width = "343" height = "50" alt = "Synesis Software" /></a>
  </td>
  <td align = "center" valign = "middle">
   <a href = "http://stlsoft.org"><img src = "stlsoft200x100.jpg" border = "0" width = "100" height = "50" alt = "STLSoft - ... Robust, Lightweight, Cross-platform, Template Software ..." /></a>
  </td>
<!--
  <td align = "center" valign = "middle">
   <a href = "http://comstl.org"><img src = "comstl200x100.jpg" border = "0" width = "100" height = "50" alt = "COMSTL - where the Standard Template Library meets the Component Object Model" /></a>
  </td>
  <td align = "center" valign = "middle">
   <a href = "http://unixstl.org"><img src = "unixstl200x100.jpg" border = "0" width = "100" height = "50" alt = "UNIXSTL - Template Software for the UNIX Operating System" /></a>
  </td>
  <td align = "center" valign = "middle">
   <a href = "http://winstl.org"><img src = "winstl200x100.jpg" border = "0" width = "100" height = "50" alt = "WinSTL - where the Standard Template Library meets the Win32 API" /></a>
  </td>
-->
 </tr>
 <tr>
  <td width = "100%" colspan = "4">
   <hr width = "100%">
  </td>
 </tr>
</table>
<!-- Generated by Doxygen 1.2.18 -->
<center>
<a class="qindex" href="main.html">Main Page</a> &nbsp; <a class="qindex" href="modules.html">Modules</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr>
<p>
<h2><a name="section_sample_C">Using Open-RJ in C</a>
</h2>
<p>
Open-RJ is written in C, and expresses a C-API, so programming in C means programming to the core API.
<p>
There are two sample programs provided:
<p>
<ul>
<li>The <a href="page_using_c.html#subsection_sample_C_C_simple">C_simple</a> program provides a minimal example of using the Open-RJ core API, intended to get you up and running as soon as possible.</ul>
<ul>
<li>The <a href="page_using_c.html#subsection_sample_C_C_full">C_full</a> program provides a full example of using the Open-RJ core API, intended to demonstrate all the available functionality.</ul>
<h3><a name="subsection_sample_C_C_simple">C_simple</a>
</h3>
<p>
This sample/test program, located in the <b>test/C_simple</b> subdirectory, shows a minimal use of the API, to load a memory database (from a literal string), display information about the database (# of lines, fields, records), and then enumerate the records and their constituent fields.
<p>
It performs these tasks twice, demonstrating the use of the raw data structures, and of the API functions.
<p>
<div class="fragment"><pre><span class="comment">/* </span>
<span class="comment"> * File:        C_simple.c</span>
<span class="comment"> *</span>
<span class="comment"> * Purpose:     C test program for the Open-RJ core library. This program uses</span>
<span class="comment"> *              the memory database functions, and attempts to be a</span>
<span class="comment"> *              smallest-possible informative example.</span>
<span class="comment"> *</span>
<span class="comment"> * Created:     25th May 2005</span>
<span class="comment"> * Updated:     25th May 2005</span>
<span class="comment"> *</span>
<span class="comment"> * www:         http://www.openrj.org/</span>
<span class="comment"> *</span>
<span class="comment"> * Thanks:      To Rajiv Bhagwat for pointing out that the test programs left</span>
<span class="comment"> *              much to be desired in terms of discoverability.</span>
<span class="comment"> *</span>
<span class="comment"> * License:     Copyright 2004-2005, Synesis Software Pty Ltd.</span>
<span class="comment"> *              All rights reserved.</span>
<span class="comment"> *</span>
<span class="comment"> *              (Licensed under the Synesis Software Open License)</span>
<span class="comment"> *</span>
<span class="comment"> *              This source code is placed into the public domain 2005</span>
<span class="comment"> *              by Synesis Software Pty Ltd. There are no restrictions</span>
<span class="comment"> *              whatsoever to your use of the software.</span>
<span class="comment"> *</span>
<span class="comment"> * </span>
<span class="comment"></span>
<span class="comment"></span>
<span class="comment">/* Open-RJ Header Files */</span>
<span class="preprocessor">#include &lt;<a class="code" href="openrj_8h.html">openrj/openrj.h</a>&gt;</span>

<span class="comment">/* Standard C Library Files */</span>
<span class="preprocessor">#include &lt;stdio.h&gt;</span>
<span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<span class="preprocessor">#include &lt;string.h&gt;</span>

<span class="comment">/* </span>
<span class="comment"> * Globals</span>
<span class="comment"> */</span>

<span class="comment">// Sample database</span>
<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span>   contents[] =

    <span class="stringliteral">"%% Sample Open-RJ database - Cats and Dogs\n"</span>
    <span class="stringliteral">"%% Created:   28th September 2004\n"</span>
    <span class="stringliteral">"%% Updated:   29th September 2004\n"</span>
    <span class="stringliteral">"Name:      Barney\n"</span>
    <span class="stringliteral">"Species:   Dog\n"</span>
    <span class="stringliteral">"Breed:     Bijon \\\n"</span>
    <span class="stringliteral">"           Frieze\n"</span>
    <span class="stringliteral">"%%\n"</span>
    <span class="stringliteral">"Name:      Elsa\n"</span>
    <span class="stringliteral">"Species:   Dog\n"</span>
    <span class="stringliteral">"Breed:     Mixed\n"</span>
    <span class="stringliteral">"%%\n"</span>
    <span class="stringliteral">"Name:      Fluffy Kitten\n"</span>
    <span class="stringliteral">"Species:   Cat\n"</span>
    <span class="stringliteral">"%%\n"</span>
    <span class="stringliteral">"Name:      Moet\n"</span>
    <span class="stringliteral">"Species:   Dog\n"</span>
    <span class="stringliteral">"Breed:     Boxer\n"</span>
    <span class="stringliteral">"%%\n"</span>
    <span class="stringliteral">"Name:      Rebel\n"</span>
    <span class="stringliteral">"Species:   Dog\n"</span>
    <span class="stringliteral">"Breed:     German \\\n"</span>
    <span class="stringliteral">"           Shepherd\n"</span>
    <span class="stringliteral">"%%\n"</span>
    <span class="stringliteral">"Name:      Pepper\n"</span>
    <span class="stringliteral">"Species:   Dog\n"</span>
    <span class="stringliteral">"Breed:     Border Collie\n"</span>
    <span class="stringliteral">"%%\n"</span>
    <span class="stringliteral">"Name:      Samson\n"</span>
    <span class="stringliteral">"Species:   Dog\n"</span>
    <span class="stringliteral">"Breed:     Ridgeback\n"</span>
    <span class="stringliteral">"%%\n"</span>
    <span class="stringliteral">"Name:      Sheltie\n"</span>
    <span class="stringliteral">"Species:   Dog\n"</span>
    <span class="stringliteral">"Breed:     Shetland \\\n"</span>
    <span class="stringliteral">"           Sheepdog\n"</span>
    <span class="stringliteral">"%%\n"</span>
    <span class="stringliteral">"Name:      Sparky\n"</span>
    <span class="stringliteral">"Species:   Cat\n"</span>
    <span class="stringliteral">"%%\n"</span>;

<span class="comment">/* </span>
<span class="comment"></span>
<span class="comment">int main(int argc, char *argv[])</span>
<span class="comment">{</span>
<span class="comment">    unsigned            flags       =   0; /* Could try ORJ_FLAG_ORDERFIELDS and/or ORJ_FLAG_ELIDEBLANKRECORDS */</span>
    <a class="code" href="namespaceopenrj.html#a4">ORJDatabase</a> <span class="keyword">const</span>   *db;
    ORJError            error;
    <a class="code" href="namespaceopenrj.html#a59">ORJRC</a>               rc;

    <span class="comment">/* 1. Create a database instance on memory, so use memory_database */</span>
    rc = <a class="code" href="namespaceopenrj.html#a44">ORJ_CreateDatabaseFromMemory</a>(contents, <span class="keyword">sizeof</span>(contents), NULL, flags, &amp;db, &amp;error);

    <span class="keywordflow">if</span>(0 != rc)
    {
        printf(<span class="stringliteral">"Error at line %u, column %u: %s\n"</span>, error.invalidLine, error.invalidColumn, ORJ_GetErrorStringA(rc));

        <span class="keywordflow">return</span> EXIT_FAILURE;
    }
    <span class="keywordflow">else</span>
    {
        <span class="comment">/* 2. Display database characteristics using structure accesses */</span>
        printf(<span class="stringliteral">"\n2. Display database characteristics (via structure member access):\n"</span>);

        printf(<span class="stringliteral">"Database has %u lines in %u fields in %u records\n"</span>, db-&gt;numLines, db-&gt;numFields, db-&gt;numRecords);

        <span class="comment">/* 3. Display database characteristics using method calls */</span>
        printf(<span class="stringliteral">"\n3. Display database characteristics (via API function call):\n"</span>);

        printf(<span class="stringliteral">"Database has %u lines in %u fields in %u records\n"</span>, <a class="code" href="namespaceopenrj.html#a26">ORJ_Database_GetNumLinesA</a>(db), <a class="code" href="namespaceopenrj.html#a27">ORJ_Database_GetNumFieldsA</a>(db), <a class="code" href="namespaceopenrj.html#a28">ORJ_Database_GetNumRecordsA</a>(db));

        <span class="comment">/* 4. Enumerate the contents using structure accesses */</span>
        {
            size_t  iRecord;

            printf(<span class="stringliteral">"\n4. Enumerate the contents  (via structure member access):\n"</span>);

            <span class="keywordflow">for</span>(iRecord = 0; iRecord &lt; db-&gt;numRecords; ++iRecord)
            {
                size_t      iField;
                ORJRecordA  *rec =   &amp;db-&gt;records[iRecord];

                <span class="keywordflow">if</span>( NULL != rec-&gt;comment.ptr &amp;&amp;
                    0 != rec-&gt;comment.len)
                {
                    printf(<span class="stringliteral">"record-#%u; %.*s (%u fields)\n"</span>, iRecord, rec-&gt;comment.len, rec-&gt;comment.ptr, rec-&gt;numFields);
                }
                <span class="keywordflow">else</span>
                {
                    printf(<span class="stringliteral">"record-#%d (%d fields)\n"</span>, iRecord, rec-&gt;numFields);
                }

                <span class="keywordflow">for</span>(iField = 0; iField &lt; rec-&gt;numFields; ++iField)
                {
                    ORJFieldA   *field  =   &amp;rec-&gt;fields[iField];

                    printf(<span class="stringliteral">"  field-#%d [%.*s]:[%.*s]\n"</span>, iField, field-&gt;name.len, field-&gt;name.ptr, field-&gt;value.len, field-&gt;value.ptr);
                }
            }
        }

        <span class="comment">/* 5. Enumerate the contents using method calls */</span>
        {
            size_t  iRecord;

            printf(<span class="stringliteral">"\n5. Enumerate the contents  (via API function call):\n"</span>);

            <span class="keywordflow">for</span>(iRecord = 0; iRecord &lt; <a class="code" href="namespaceopenrj.html#a28">ORJ_Database_GetNumRecordsA</a>(db); ++iRecord)
            {
                size_t              iField;
                ORJRecordA <span class="keyword">const</span>    *rec;
                ORJStringA <span class="keyword">const</span>    *comment;

                <a class="code" href="orjapi_8c.html#a9">ORJ_Database_GetRecordA</a>(db, iRecord, &amp;rec);

                <span class="keywordflow">if</span>( <a class="code" href="namespaceopenrj.html#a59a9">ORJ_RC_SUCCESS</a> == <a class="code" href="orjapi_8c.html#a13">ORJ_Record_GetCommentA</a>(rec, &amp;comment) &amp;&amp;
                    0 != comment-&gt;len)
                {
                    printf(<span class="stringliteral">"record-#%u; %.*s (%u fields)\n"</span>, iRecord, comment-&gt;len, comment-&gt;ptr, <a class="code" href="namespaceopenrj.html#a30">ORJ_Record_GetNumFieldsA</a>(rec));
                }
                <span class="keywordflow">else</span>
                {
                    printf(<span class="stringliteral">"record-#%u (%u fields)\n"</span>, iRecord, <a class="code" href="namespaceopenrj.html#a30">ORJ_Record_GetNumFieldsA</a>(rec));
                }

                <span class="keywordflow">for</span>(iField = 0; iField &lt; <a class="code" href="namespaceopenrj.html#a30">ORJ_Record_GetNumFieldsA</a>(rec); ++iField)
                {
                    ORJFieldA <span class="keyword">const</span>     *field;
                    ORJFieldA <span class="keyword">const</span>     *field2;
                    ORJStringA <span class="keyword">const</span>    *name;
                    ORJStringA <span class="keyword">const</span>    *value;

                    <a class="code" href="orjapi_8c.html#a10">ORJ_Record_GetFieldA</a>(rec, iField, &amp;field);

                    <a class="code" href="orjapi_8c.html#a16">ORJ_Field_GetNameAndValueA</a>(field, &amp;name, &amp;value);

                    printf(<span class="stringliteral">"  field-#%u [%.*s]:[%.*s]\n"</span>, iField, (<span class="keywordtype">int</span>)field-&gt;name.len, field-&gt;name.ptr, (<span class="keywordtype">int</span>)field-&gt;value.len, field-&gt;value.ptr);

<span class="preprocessor">#ifndef OPENRJ_DOCUMENTATION_SKIP_SECTION</span>
<span class="preprocessor"></span>                    <span class="comment">/* Now do a check to verify that the ORJ_Record_FindFieldByNameA() method works! */</span>

                    field2  =   <a class="code" href="orjapi_8c.html#a11">ORJ_Record_FindFieldByNameA</a>(rec, name-&gt;ptr, value-&gt;ptr);

                    <span class="keywordflow">if</span>(field != field2)
                    {
                        fprintf(stderr, <span class="stringliteral">"** Field mismatch!! **\n"</span>);
                    }
<span class="preprocessor">#endif </span><span class="comment">/* !OPENRJ_DOCUMENTATION_SKIP_SECTION */</span>
                }
            }
        }

        <span class="comment">/* Finally, free the database */</span>
        <a class="code" href="namespaceopenrj.html#a45">ORJ_FreeDatabase</a>(db);
    }

        ((void)argc);
        ((void)argv);

    <span class="keywordflow">return</span> EXIT_SUCCESS;
}

<span class="comment">/* </span>
<span class="comment"> * end of file</span>
<span class="comment"> */</span>
</pre></div>
<p>
<h3><a name="subsection_sample_C_C_full">C_full</a>
</h3>
<p>
This sample/test program, located in the <b>test/C_full</b> subdirectory, shows a full use of the C-API, including error-handling and use of the file-database function to load a file named on the command-line. It also allows the specification of the ORJ_FLAG_ORDERFIELDS and/or ORJ_FLAG_ELIDEBLANKRECORDS flags, via the command-line, which can moderate the database contents as expressed by the API.
<p>
This program has various aspects that are peripheral to the quick absorption of the API, and should be examined and tested after <a href="page_using_c.html#subsection_sample_C_C_simple">C_simple</a>.
<p>
<div class="fragment"><pre><span class="comment">/* </span>
<span class="comment"> * File:        C_full.c</span>
<span class="comment"> *</span>
<span class="comment"> * Purpose:     C test program for the Open-RJ library.</span>
<span class="comment"> *</span>
<span class="comment"> * Created:     11th June 2004</span>
<span class="comment"> * Updated:     25th May 2005</span>
<span class="comment"> *</span>
<span class="comment"> * www:         http://www.openrj.org/</span>
<span class="comment"> *</span>
<span class="comment"> * Thanks:      To Rajiv Bhagwat for pointing out that the test programs left</span>
<span class="comment"> *              much to be desired in terms of discoverability.</span>
<span class="comment"> *</span>
<span class="comment"> * License:     Copyright 2004-2005, Synesis Software Pty Ltd.</span>
<span class="comment"> *              All rights reserved.</span>
<span class="comment"> *</span>
<span class="comment"> *              (Licensed under the Synesis Software Open License)</span>
<span class="comment"> *</span>
<span class="comment"> *              This source code is placed into the public domain 2004</span>
<span class="comment"> *              by Synesis Software Pty Ltd. There are no restrictions</span>
<span class="comment"> *              whatsoever to your use of the software.</span>
<span class="comment"> *</span>
<span class="comment"> * </span>
<span class="comment"></span>
<span class="comment"></span>
<span class="comment">/* Open-RJ Header Files */</span>
<span class="preprocessor">#include &lt;<a class="code" href="openrj_8h.html">openrj/openrj.h</a>&gt;</span>

<span class="comment">/* Standard C Library Files */</span>
<span class="preprocessor">#include &lt;stdio.h&gt;</span>
<span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<span class="preprocessor">#include &lt;string.h&gt;</span>

<span class="comment">/* </span>
<span class="comment"> * Compiler warning handling</span>
<span class="comment"> */</span>

<span class="preprocessor">#if defined(_MSC_VER) &amp;&amp; \</span>
<span class="preprocessor">    !defined(__INTEL_COMPILER) &amp;&amp; \</span>
<span class="preprocessor">    !defined(__DMC__)</span>
<span class="preprocessor"></span><span class="preprocessor"># if _MSC_VER &lt; 1300</span>
<span class="preprocessor"></span><span class="preprocessor">#  pragma warning(disable : 4127)   </span><span class="comment">/* Suppresses "conditional expression is constant", found in assertions */</span>
<span class="preprocessor"># endif </span><span class="comment">/* _MSC_VER &lt; 1300 */</span>
<span class="preprocessor">#endif </span><span class="comment">/* compiler */</span>

<span class="comment">/* </span>
<span class="comment"> * Helper function declarations</span>
<span class="comment"> */</span>

<span class="keyword">static</span> <span class="keywordtype">void</span> usage(<span class="keywordtype">int</span> bExit, <span class="keywordtype">char</span> <span class="keyword">const</span> *reason, <span class="keywordtype">int</span> invalidArg, <span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[]);
<span class="keyword">static</span> <span class="keywordtype">int</span>  run_unittests(<span class="keywordtype">void</span>);
<span class="keyword">static</span> <span class="keywordtype">int</span>  execute_unittest(ORJDatabaseA <span class="keyword">const</span> *<a class="code" href="namespaceopenrj_1_1stl.html#a0">database</a>);

<span class="comment">/* </span>
<span class="comment"></span>
<span class="comment">int main(int argc, char *argv[])</span>
<span class="comment">{</span>
<span class="comment">    int         i;</span>
<span class="comment">    char const  *jarName    =   NULL;</span>
<span class="comment">    unsigned    flags       =   0;</span>
<span class="comment"></span>
<span class="comment">    /* Parse the command-line arguments. */</span>
    <span class="keywordflow">for</span>(i = 1; i &lt; argc; ++i)
    {
        <span class="keyword">const</span> <span class="keywordtype">char</span>  *arg    =   argv[i];

        <span class="keywordflow">if</span>(arg[0] == <span class="charliteral">'-'</span>)
        {
            <span class="keywordflow">if</span>(arg[1] == <span class="charliteral">'-'</span>)
            {
                <span class="comment">/* -- arguments */</span>
                <span class="keywordflow">if</span>( 0 == strcmp(<span class="stringliteral">"unittest"</span>, arg + 2) ||
                    0 == strcmp(<span class="stringliteral">"unittests"</span>, arg + 2))
                {
                    <span class="keywordflow">return</span> run_unittests();
                }
                <span class="keywordflow">else</span>
                {
                    usage(1, <span class="stringliteral">"Invalid argument(s) specified"</span>, i, argc, argv);
                }
            }
            <span class="keywordflow">else</span>
            {
                <span class="comment">/* - arguments */</span>
                <span class="keywordflow">switch</span>(arg[1])
                {
                    <span class="keywordflow">case</span>    <span class="charliteral">'?'</span>:
                        usage(1, NULL, -1, argc, argv);
                        <span class="keywordflow">break</span>;
                    <span class="keywordflow">case</span>    <span class="charliteral">'o'</span>:
                        flags |= <a class="code" href="namespaceopenrj.html#a58a5">ORJ_FLAG_ORDERFIELDS</a>;
                        <span class="keywordflow">break</span>;
                    <span class="keywordflow">case</span>    <span class="charliteral">'s'</span>:
                        flags |= <a class="code" href="namespaceopenrj.html#a58a6">ORJ_FLAG_ELIDEBLANKRECORDS</a>;
                        <span class="keywordflow">break</span>;
                    <span class="keywordflow">default</span>:
                        usage(1, <span class="stringliteral">"Invalid argument(s) specified"</span>, i, argc, argv);
                        <span class="keywordflow">break</span>;
                }
            }
        }
        <span class="keywordflow">else</span>
        {
            <span class="comment">/* other arguments */</span>
            <span class="keywordflow">if</span>(NULL == jarName)
            {
                jarName = arg;
            }
            <span class="keywordflow">else</span>
            {
                usage(1, <span class="stringliteral">"Invalid argument(s) specified"</span>, i, argc, argv);
            }
        }
    }

    <span class="keywordflow">if</span>(NULL == jarName)
    {
        usage(1, <span class="stringliteral">"Must specify a JAR name"</span>, -1, argc, argv);
    }
    <span class="keywordflow">else</span>
    {
        <span class="comment">/* Here's where the use of the library starts. */</span>

        <a class="code" href="namespaceopenrj.html#a4">ORJDatabase</a> <span class="keyword">const</span>   *<a class="code" href="namespaceopenrj_1_1stl.html#a0">database</a>;
        ORJError            error;
        <a class="code" href="namespaceopenrj.html#a59">ORJRC</a>               rc  =   <a class="code" href="namespaceopenrj.html#a43">ORJ_ReadDatabase</a>(jarName, NULL, flags, &amp;<a class="code" href="namespaceopenrj_1_1stl.html#a0">database</a>, &amp;error);

        <span class="keywordflow">if</span>(0 != rc)
        {
            printf(<span class="stringliteral">"Error in %s, at line %u, column %u\n"</span>, jarName, error.invalidLine, error.invalidColumn);
        }
        <span class="keywordflow">else</span>
        {
            size_t  iRecord;

<span class="preprocessor">#if 0 </span><span class="comment">/* Change this to 1 to exercise the database via structure members, rather than via API functions */</span>
            printf(<span class="stringliteral">"Record-JAR %s has %d lines in %d fields in %d records\n"</span>, jarName, <a class="code" href="namespaceopenrj_1_1stl.html#a0">database</a>-&gt;numLines, <a class="code" href="namespaceopenrj_1_1stl.html#a0">database</a>-&gt;numFields, <a class="code" href="namespaceopenrj_1_1stl.html#a0">database</a>-&gt;numRecords);

            <span class="keywordflow">for</span>(iRecord = 0; iRecord &lt; <a class="code" href="namespaceopenrj_1_1stl.html#a0">database</a>-&gt;numRecords; ++iRecord)
            {
                size_t      iField;
                ORJRecordA  *record =   &amp;<a class="code" href="namespaceopenrj_1_1stl.html#a0">database</a>-&gt;records[iRecord];

                <span class="keywordflow">if</span>( NULL != record-&gt;comment.ptr &amp;&amp;
                    0 != record-&gt;comment.len)
                {
                    printf(<span class="stringliteral">"record-#%u; %.*s (%u fields)\n"</span>, iRecord, record-&gt;comment.len, record-&gt;comment.ptr, record-&gt;numFields);
                }
                <span class="keywordflow">else</span>
                {
                    printf(<span class="stringliteral">"record-#%d (%d fields)\n"</span>, iRecord, record-&gt;numFields);
                }

                <span class="keywordflow">for</span>(iField = 0; iField &lt; record-&gt;numFields; ++iField)
                {
                    ORJFieldA   *field  =   &amp;record-&gt;fields[iField];

                    printf(<span class="stringliteral">"  field-#%d [%.*s]:[%.*s]\n"</span>, iField, field-&gt;name.len, field-&gt;name.ptr, field-&gt;value.len, field-&gt;value.ptr);
                }
            }
<span class="preprocessor">#else </span><span class="comment">/* ? 0 */</span>
            printf(<span class="stringliteral">"Record-JAR %s has %u lines in %u fields in %u records\n"</span>, jarName, <a class="code" href="namespaceopenrj.html#a26">ORJ_Database_GetNumLinesA</a>(<a class="code" href="namespaceopenrj_1_1stl.html#a0">database</a>), <a class="code" href="namespaceopenrj.html#a27">ORJ_Database_GetNumFieldsA</a>(<a class="code" href="namespaceopenrj_1_1stl.html#a0">database</a>), <a class="code" href="namespaceopenrj.html#a28">ORJ_Database_GetNumRecordsA</a>(<a class="code" href="namespaceopenrj_1_1stl.html#a0">database</a>));

            <span class="keywordflow">for</span>(iRecord = 0; iRecord &lt; <a class="code" href="namespaceopenrj.html#a28">ORJ_Database_GetNumRecordsA</a>(<a class="code" href="namespaceopenrj_1_1stl.html#a0">database</a>); ++iRecord)
            {
                size_t              iField;
                ORJRecordA <span class="keyword">const</span>    *record;
                ORJStringA <span class="keyword">const</span>    *comment;

                <a class="code" href="orjapi_8c.html#a9">ORJ_Database_GetRecordA</a>(<a class="code" href="namespaceopenrj_1_1stl.html#a0">database</a>, iRecord, &amp;record);

                <span class="keywordflow">if</span>( <a class="code" href="namespaceopenrj.html#a59a9">ORJ_RC_SUCCESS</a> == <a class="code" href="orjapi_8c.html#a13">ORJ_Record_GetCommentA</a>(record, &amp;comment) &amp;&amp;
                    0 != comment-&gt;len)
                {
                    printf(<span class="stringliteral">"record-#%u; %.*s (%u fields)\n"</span>, iRecord, comment-&gt;len, comment-&gt;ptr, <a class="code" href="namespaceopenrj.html#a30">ORJ_Record_GetNumFieldsA</a>(record));
                }
                <span class="keywordflow">else</span>
                {
                    printf(<span class="stringliteral">"record-#%u (%u fields)\n"</span>, iRecord, <a class="code" href="namespaceopenrj.html#a30">ORJ_Record_GetNumFieldsA</a>(record));
                }

                <span class="keywordflow">for</span>(iField = 0; iField &lt; <a class="code" href="namespaceopenrj.html#a30">ORJ_Record_GetNumFieldsA</a>(record); ++iField)
                {
                    ORJFieldA <span class="keyword">const</span>     *field;
                    ORJFieldA <span class="keyword">const</span>     *field2;
                    ORJStringA <span class="keyword">const</span>    *name;
                    ORJStringA <span class="keyword">const</span>    *value;

                    <a class="code" href="orjapi_8c.html#a10">ORJ_Record_GetFieldA</a>(record, iField, &amp;field);

                    <a class="code" href="orjapi_8c.html#a16">ORJ_Field_GetNameAndValueA</a>(field, &amp;name, &amp;value);

                    printf(<span class="stringliteral">"  field-#%u [%.*s]:[%.*s]\n"</span>, iField, (<span class="keywordtype">int</span>)field-&gt;name.len, field-&gt;name.ptr, (<span class="keywordtype">int</span>)field-&gt;value.len, field-&gt;value.ptr);

                    <span class="comment">/* Now do a check to verify that the ORJ_Record_FindFieldByNameA() method works! */</span>

                    field2  =   <a class="code" href="orjapi_8c.html#a11">ORJ_Record_FindFieldByNameA</a>(record, name-&gt;ptr, value-&gt;ptr);

                    <span class="keywordflow">if</span>(field != field2)
                    {
                        fprintf(stderr, <span class="stringliteral">"** Field mismatch!! **\n"</span>);
                    }
                }
            }
<span class="preprocessor">#endif </span><span class="comment">/* 0 */</span>

            <a class="code" href="namespaceopenrj.html#a45">ORJ_FreeDatabase</a>(<a class="code" href="namespaceopenrj_1_1stl.html#a0">database</a>);
        }
    }

    <span class="keywordflow">return</span> EXIT_SUCCESS;
}

<span class="comment">/* </span>
<span class="comment"> * Worker functions</span>
<span class="comment"> */</span>

<span class="preprocessor">#if defined(__GNUC__)</span>
<span class="preprocessor"></span><span class="preprocessor"># ifdef alloca</span>
<span class="preprocessor"></span><span class="preprocessor">#  undef alloca</span>
<span class="preprocessor"></span><span class="preprocessor"># endif </span><span class="comment">/* !alloca */</span>
<span class="preprocessor"># define alloca             __builtin_alloca</span>
<span class="preprocessor"></span><span class="preprocessor">#elif defined(WIN32)</span>
<span class="preprocessor"></span><span class="preprocessor"># include &lt;malloc.h&gt;</span>
<span class="preprocessor"># ifndef alloca</span>
<span class="preprocessor"></span><span class="preprocessor">#  define alloca            _alloca</span>
<span class="preprocessor"></span><span class="preprocessor"># endif </span><span class="comment">/* !alloca */</span>
<span class="preprocessor">#else </span><span class="comment">/* ? OS */</span>
<span class="preprocessor"># include &lt;alloca.h&gt;</span>
<span class="preprocessor">#endif </span><span class="comment">/* OS */</span>

<span class="keyword">static</span> <span class="keywordtype">void</span> usage(<span class="keywordtype">int</span> bExit, <span class="keywordtype">char</span> <span class="keyword">const</span> *reason, <span class="keywordtype">int</span> invalidArg, <span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)
{
    <span class="comment">/* Get the executable name */</span>
    <span class="keywordtype">char</span>    *EXE_NAME   =   strcpy((<span class="keywordtype">char</span>*)alloca(1 + strlen(argv[0])), argv[0]);
    <span class="keywordtype">char</span>    *p;

    <span class="keywordflow">if</span>(NULL != (p = strrchr(EXE_NAME, <span class="charliteral">'\\'</span>)))
    {
        0[(EXE_NAME = p + 1) - 1] = <span class="charliteral">'\0'</span>;
    }

    <span class="keywordflow">if</span>(NULL != (p = strrchr(EXE_NAME, <span class="charliteral">'/'</span>)))
    {
        0[(EXE_NAME = p + 1) - 1] = <span class="charliteral">'\0'</span>;
    }


    fprintf(stderr, <span class="stringliteral">"\n"</span>);
    fprintf(stderr, <span class="stringliteral">"  Open-RJ C test program: %s\n"</span>, EXE_NAME);
    fprintf(stderr, <span class="stringliteral">"\n"</span>);

    <span class="keywordflow">if</span>(NULL != reason)
    {
        fprintf(stderr, <span class="stringliteral">"  Error: %s\n"</span>, reason);
        fprintf(stderr, <span class="stringliteral">"\n"</span>);
    }

    <span class="keywordflow">if</span>(0 &lt; invalidArg)
    {
        <span class="keywordtype">int</span> i;

        fprintf(stderr, <span class="stringliteral">"  First invalid argument #%d: %s\n"</span>, invalidArg, argv[invalidArg]);
        fprintf(stderr, <span class="stringliteral">"  Arguments were (first bad marked *):\n\n"</span>);
        <span class="keywordflow">for</span>(i = 1; i &lt; argc; ++i)
        {
            fprintf(stderr, <span class="stringliteral">"  %s%s\n"</span>, (i == invalidArg) ? <span class="stringliteral">"* "</span> : <span class="stringliteral">"  "</span>, argv[i]);
        }
        fprintf(stderr, <span class="stringliteral">"\n"</span>);
    }

    fprintf(stderr, <span class="stringliteral">"  USAGE 1: %s [-o] [-s] &lt;database&gt;\n\n"</span>, EXE_NAME);
    fprintf(stderr, <span class="stringliteral">"    -o            -   orders the fields within each record\n"</span>);
    fprintf(stderr, <span class="stringliteral">"    -s            -   elide blank records from the database\n"</span>);
    fprintf(stderr, <span class="stringliteral">"    &lt;database&gt;    -   the Open-RJ database file\n"</span>);
    fprintf(stderr, <span class="stringliteral">"\n"</span>);
    fprintf(stderr, <span class="stringliteral">"    Converts the &lt;input-file&gt; to the &lt;output-file&gt; by either\n"</span>);
    fprintf(stderr, <span class="stringliteral">"    Base-64 encoding (-e) or Base-64 decoding (-d)\n"</span>);
    fprintf(stderr, <span class="stringliteral">"\n"</span>);
    fprintf(stderr, <span class="stringliteral">"  USAGE 2: %s --unittest\n"</span>, EXE_NAME);
    fprintf(stderr, <span class="stringliteral">"\n"</span>);
    fprintf(stderr, <span class="stringliteral">"    Runs internal tests, returning 0 if all succeed, non-0 otherwise\n"</span>);
    fprintf(stderr, <span class="stringliteral">"\n"</span>);
    fprintf(stderr, <span class="stringliteral">"  USAGE 3: %s -?\n"</span>, EXE_NAME);
    fprintf(stderr, <span class="stringliteral">"\n"</span>);
    fprintf(stderr, <span class="stringliteral">"    Displays this help\n"</span>);
    fprintf(stderr, <span class="stringliteral">"\n"</span>);

    <span class="keywordflow">if</span>(bExit)
    {
        exit(EXIT_FAILURE);
    }
}

<span class="keyword">static</span> <span class="keywordtype">int</span> execute_unittest(ORJDatabaseA <span class="keyword">const</span> *<a class="code" href="namespaceopenrj_1_1stl.html#a0">database</a>)
{
    ((void)<a class="code" href="namespaceopenrj_1_1stl.html#a0">database</a>);

    <span class="comment">/* NOTE: Not yet implemented */</span>

    <span class="keywordflow">return</span> 0;
}

<span class="keyword">static</span> <span class="keywordtype">int</span> run_unittests()
{
    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span>   contents[] =

        <span class="stringliteral">"%% Sample Open-RJ database - Cats and Dogs\n"</span>
        <span class="stringliteral">"%% Created:   28th September 2004\n"</span>
        <span class="stringliteral">"%% Updated:   29th September 2004\n"</span>
        <span class="stringliteral">"Name:      Barney\n"</span>
        <span class="stringliteral">"Species:   Dog\n"</span>
        <span class="stringliteral">"Breed:     Bijon \\\n"</span>
        <span class="stringliteral">"           Frieze\n"</span>
        <span class="stringliteral">"%%\n"</span>
        <span class="stringliteral">"Name:      Elsa\n"</span>
        <span class="stringliteral">"Species:   Dog\n"</span>
        <span class="stringliteral">"Breed:     Mixed\n"</span>
        <span class="stringliteral">"%%\n"</span>
        <span class="stringliteral">"Name:      Fluffy Kitten\n"</span>
        <span class="stringliteral">"Species:   Cat\n"</span>
        <span class="stringliteral">"%%\n"</span>
        <span class="stringliteral">"Name:      Moet\n"</span>
        <span class="stringliteral">"Species:   Dog\n"</span>
        <span class="stringliteral">"Breed:     Boxer\n"</span>
        <span class="stringliteral">"%%\n"</span>
        <span class="stringliteral">"Name:      Rebel\n"</span>
        <span class="stringliteral">"Species:   Dog\n"</span>
        <span class="stringliteral">"Breed:     German \\\n"</span>
        <span class="stringliteral">"           Shepherd\n"</span>
        <span class="stringliteral">"%%\n"</span>
        <span class="stringliteral">"Name:      Pepper\n"</span>
        <span class="stringliteral">"Species:   Dog\n"</span>
        <span class="stringliteral">"Breed:     Border Collie\n"</span>
        <span class="stringliteral">"%%\n"</span>
        <span class="stringliteral">"Name:      Samson\n"</span>
        <span class="stringliteral">"Species:   Dog\n"</span>
        <span class="stringliteral">"Breed:     Ridgeback\n"</span>
        <span class="stringliteral">"%%\n"</span>
        <span class="stringliteral">"Name:      Sheltie\n"</span>
        <span class="stringliteral">"Species:   Dog\n"</span>
        <span class="stringliteral">"Breed:     Shetland \\\n"</span>
        <span class="stringliteral">"           Sheepdog\n"</span>
        <span class="stringliteral">"%%\n"</span>
        <span class="stringliteral">"Name:      Sparky\n"</span>
        <span class="stringliteral">"Species:   Cat\n"</span>
        <span class="stringliteral">"%%\n"</span>;

    <span class="comment">/* 1. Test that *not* eliding blanks gives the right number of records */</span>
    {
        <a class="code" href="namespaceopenrj.html#a4">ORJDatabase</a> <span class="keyword">const</span>   *<a class="code" href="namespaceopenrj_1_1stl.html#a0">database</a>;
        ORJError            error;
        <span class="keyword">const</span> <span class="keywordtype">unsigned</span>      flags   =   0;
        <a class="code" href="namespaceopenrj.html#a59">ORJRC</a>               rc      =   <a class="code" href="orjapi_8c.html#a6">ORJ_CreateDatabaseFromMemoryA</a>(&amp;contents[0], <span class="keyword">sizeof</span>(contents), NULL, flags, &amp;<a class="code" href="namespaceopenrj_1_1stl.html#a0">database</a>, &amp;error);

        <span class="keywordflow">if</span>(0 != rc)
        {
            fprintf(stderr, <span class="stringliteral">"Error in at line %u, column %u\n"</span>, error.invalidLine, error.invalidColumn);

            <span class="keywordflow">return</span> EXIT_FAILURE;
        }
        <span class="keywordflow">else</span>
        {
            <span class="keywordtype">int</span> iRet = 0;

            <span class="keywordflow">if</span>(12 != <a class="code" href="namespaceopenrj_1_1stl.html#a0">database</a>-&gt;numRecords)
            {
                fprintf(stderr, <span class="stringliteral">"Incorrect number of records\n"</span>);

                iRet = 1;
            }
            <span class="keywordflow">else</span> <span class="keywordflow">if</span>(25 != <a class="code" href="namespaceopenrj_1_1stl.html#a0">database</a>-&gt;numFields)
            {
                fprintf(stderr, <span class="stringliteral">"Incorrect number of fields\n"</span>);

                iRet = 1;
            }
            <span class="keywordflow">else</span>
            {
                <span class="keyword">const</span> <span class="keywordtype">int</span>   NUM_TESTS   =   1000;
                <span class="keywordtype">int</span>         i;

                <span class="keywordflow">for</span>(i = 0; i &lt; NUM_TESTS; ++i)
                {
                    iRet = execute_unittest(<a class="code" href="namespaceopenrj_1_1stl.html#a0">database</a>);

                    <span class="keywordflow">if</span>(0 != iRet)
                    {
                        <span class="keywordflow">break</span>;
                    }
                }

                <span class="keywordflow">if</span>(0 == iRet)
                {
                    fprintf(stderr, <span class="stringliteral">"%d tests succeeded\n"</span>, NUM_TESTS);
                }
                <span class="keywordflow">else</span>
                {
                    fprintf(stderr, <span class="stringliteral">"Test #%d failed\n"</span>, i);
                }
            }

            <a class="code" href="namespaceopenrj.html#a45">ORJ_FreeDatabase</a>(<a class="code" href="namespaceopenrj_1_1stl.html#a0">database</a>);

            <span class="keywordflow">return</span> (0 == iRet) ? EXIT_SUCCESS : EXIT_FAILURE;
        }
    }
}

<span class="comment">/* </span>
<span class="comment"> * end of file</span>
<span class="comment"> */</span>
</pre></div>
<p>
<table width = "100%">
 <tr>
  <td width = "100%">
   <hr width = "100%">
  </td>
 </tr>
 <tr>
  <td align = "center" valign = "middle">
   <font size = "-1">
    <a href = "http://openrj.org/"><b>Open-RJ</b></a>
    Library documentation 
    <a href = "http://synesis.com.au/">© Synesis Software Pty Ltd, 2004-2005</a>
   </font>
  </td>
 </tr>
</table>
