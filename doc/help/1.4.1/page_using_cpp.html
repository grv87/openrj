<head>
 <link href="openrj.css" rel="stylesheet" type="text/css">
</head>

<table width = "100%" cellspacing = "0" cellpadding = "0">
 <tr bgcolor="#333366">
  <td align = "center" valign = "middle">
   <a href = "http://openrj.org"><img src = "openrj_logo_small.jpg" border = "0" alt = "Open-RJ" /></a>
  </td>
  <td align = "center" valign = "middle">
   <a href = "http://www.cuj.com/"><img src = "cuj_logo.gif" border = "0" width = "155" height = "50" alt = "C/C++ User's Journal" /></a>
  </td>
  <td align = "center" valign = "middle">
   <a href = "http://www.synesis.com.au/"><img src = "syn_head.jpg" border = "0" width = "343" height = "50" alt = "Synesis Software" /></a>
  </td>
  <td align = "center" valign = "middle">
   <a href = "http://stlsoft.org"><img src = "stlsoft200x100.jpg" border = "0" width = "100" height = "50" alt = "STLSoft - ... Robust, Lightweight, Cross-platform, Template Software ..." /></a>
  </td>
<!--
  <td align = "center" valign = "middle">
   <a href = "http://comstl.org"><img src = "comstl200x100.jpg" border = "0" width = "100" height = "50" alt = "COMSTL - where the Standard Template Library meets the Component Object Model" /></a>
  </td>
  <td align = "center" valign = "middle">
   <a href = "http://unixstl.org"><img src = "unixstl200x100.jpg" border = "0" width = "100" height = "50" alt = "UNIXSTL - Template Software for the UNIX Operating System" /></a>
  </td>
  <td align = "center" valign = "middle">
   <a href = "http://winstl.org"><img src = "winstl200x100.jpg" border = "0" width = "100" height = "50" alt = "WinSTL - where the Standard Template Library meets the Win32 API" /></a>
  </td>
-->
 </tr>
 <tr>
  <td width = "100%" colspan = "4">
   <hr width = "100%">
  </td>
 </tr>
</table>
<!-- Generated by Doxygen 1.4.3 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1><a class="anchor" name="page_using_Cpp">Using Open-RJ in C++</a></h1><h2><a class="anchor" name="section_sample_Cpp">
Using Open-RJ in C++</a></h2>
There are two Open-RJ mappings for C++:<p>
<ul>
<li><b>Open-RJ/C++</b> (in the <a class="el" href="namespaceopenrj_1_1cpp.html">openrj::cpp</a> namespace) is a 'classic' mapping, i.e. the classes present a non-STL interface</li><li><b>Open-RJ/STL</b> (in the <a class="el" href="namespaceopenrj_1_1stl.html">openrj::stl</a> namespace) is an STL-like mapping</li></ul>
<p>
For <b>Open-RJ/C++</b> there are two sample programs provided:<p>
<ul>
<li>The <a class="el" href="page_using_cpp.html#subsection_sample_Cpp_Cpp_simple">Cpp_simple</a> program provides a minimal example of using the Open-RJ/C++ mapping, intended to get you up and running as soon as possible.</li></ul>
<p>
<ul>
<li>The <a class="el" href="page_using_cpp.html#subsection_sample_Cpp_Cpp_full">Cpp_full</a> program provides a full example of using the Open-RJ/C++ mapping, intended to demonstrate all the available functionality.</li></ul>
<p>
For <b>Open-RJ/STL</b> there are two sample programs provided:<p>
<ul>
<li>The <a class="el" href="page_using_cpp.html#subsection_sample_STL_STL_simple">STL_simple</a> program provides a minimal example of using the Open-RJ/STL mapping, intended to get you up and running as soon as possible.</li></ul>
<p>
<ul>
<li>The <a class="el" href="page_using_cpp.html#subsection_sample_STL_STL_full">STL_full</a> program provides a full example of using the Open-RJ/STL mapping, intended to demonstrate all the available functionality.</li></ul>
<h3><a class="anchor" name="subsection_sample_Cpp_Cpp_simple">
Cpp_simple</a></h3>
This sample/test program, located in the <b>test/Cpp_simple</b> subdirectory, shows a minimal use of the mapping, to load a memory database (from a literal string), display information about the database (# of lines, fields, records), and then enumerate the records and their constituent fields.<p>
<div class="fragment"><pre class="fragment"><span class="comment">/* /////////////////////////////////////////////////////////////////////////////</span>
<span class="comment"> * File:        Cpp_simple.cpp</span>
<span class="comment"> *</span>
<span class="comment"> * Purpose:     C++ test program for the Open-RJ/C++ (the C++ mapping of the</span>
<span class="comment"> *              Open-RJ library). This program uses the memory_database class</span>
<span class="comment"> *              and attempts to be a smallest-possible informative example.</span>
<span class="comment"> *</span>
<span class="comment"> * Created:     24th May 2005</span>
<span class="comment"> * Updated:     19th June 2005</span>
<span class="comment"> *</span>
<span class="comment"> * www:         http://www.openrj.org/</span>
<span class="comment"> *</span>
<span class="comment"> * Thanks:      To Rajiv Bhagwat for pointing out that the test programs left</span>
<span class="comment"> *              much to be desired in terms of discoverability.</span>
<span class="comment"> *</span>
<span class="comment"> * License:     Copyright 2005, Synesis Software Pty Ltd.</span>
<span class="comment"> *              All rights reserved.</span>
<span class="comment"> *</span>
<span class="comment"> *              (Licensed under the Synesis Software Open License)</span>
<span class="comment"> *</span>
<span class="comment"> *              This source code is placed into the public domain 2005</span>
<span class="comment"> *              by Synesis Software Pty Ltd. There are no restrictions</span>
<span class="comment"> *              whatsoever to your use of the software.</span>
<span class="comment"> *</span>
<span class="comment"> * ////////////////////////////////////////////////////////////////////////// */</span>


<span class="comment">/* Open-RJ Header Files */</span>
<span class="preprocessor">#include &lt;<a class="code" href="cpp_2database_8hpp.html">openrj/cpp/database.hpp</a>&gt;</span>

<span class="comment">/* Standard C++ Library Files */</span>
<span class="preprocessor">#include &lt;iostream&gt;</span>

<span class="comment">/* /////////////////////////////////////////////////////////////////////////////</span>
<span class="comment"> * Namespace</span>
<span class="comment"> */</span>

<span class="keyword">using</span> std::cerr;
<span class="keyword">using</span> std::endl;
<span class="keyword">using</span> std::cout;

<span class="comment">/* /////////////////////////////////////////////////////////////////////////////</span>
<span class="comment"> * Globals</span>
<span class="comment"> */</span>

<span class="comment">// Sample database</span>
<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span>   contents[] =

    <span class="stringliteral">"%% Sample Open-RJ database - Cats and Dogs\n"</span>
    <span class="stringliteral">"%% Created:   28th September 2004\n"</span>
    <span class="stringliteral">"%% Updated:   29th September 2004\n"</span>
    <span class="stringliteral">"Name:      Barney\n"</span>
    <span class="stringliteral">"Species:   Dog\n"</span>
    <span class="stringliteral">"Breed:     Bijon \\\n"</span>
    <span class="stringliteral">"           Frieze\n"</span>
    <span class="stringliteral">"%%\n"</span>
    <span class="stringliteral">"Name:      Elsa\n"</span>
    <span class="stringliteral">"Species:   Dog\n"</span>
    <span class="stringliteral">"Breed:     Mixed\n"</span>
    <span class="stringliteral">"%%\n"</span>
    <span class="stringliteral">"Name:      Fluffy Kitten\n"</span>
    <span class="stringliteral">"Species:   Cat\n"</span>
    <span class="stringliteral">"%%\n"</span>
    <span class="stringliteral">"Name:      Moet\n"</span>
    <span class="stringliteral">"Species:   Dog\n"</span>
    <span class="stringliteral">"Breed:     Boxer\n"</span>
    <span class="stringliteral">"%%\n"</span>
    <span class="stringliteral">"Name:      Rebel\n"</span>
    <span class="stringliteral">"Species:   Dog\n"</span>
    <span class="stringliteral">"Breed:     German \\\n"</span>
    <span class="stringliteral">"           Shepherd\n"</span>
    <span class="stringliteral">"%%\n"</span>
<span class="preprocessor">#if !defined(__GNUC__)</span>
<span class="preprocessor"></span>    <span class="stringliteral">"Name:      Pepper\n"</span>
    <span class="stringliteral">"Species:   Dog\n"</span>
    <span class="stringliteral">"Breed:     Border Collie\n"</span>
    <span class="stringliteral">"%%\n"</span>
    <span class="stringliteral">"Name:      Samson\n"</span>
    <span class="stringliteral">"Species:   Dog\n"</span>
    <span class="stringliteral">"Breed:     Ridgeback\n"</span>
    <span class="stringliteral">"%%\n"</span>
    <span class="stringliteral">"Name:      Sheltie\n"</span>
    <span class="stringliteral">"Species:   Dog\n"</span>
    <span class="stringliteral">"Breed:     Shetland \\\n"</span>
    <span class="stringliteral">"           Sheepdog\n"</span>
    <span class="stringliteral">"%%\n"</span>
<span class="preprocessor">#endif </span><span class="comment">/* compiler */</span>
    <span class="stringliteral">"Name:      Sparky\n"</span>
    <span class="stringliteral">"Species:   Cat\n"</span>
    <span class="stringliteral">"%%\n"</span>;

<span class="comment">/* ////////////////////////////////////////////////////////////////////////// */</span>

<span class="keywordtype">int</span> main(<span class="keywordtype">int</span> <span class="comment">/* argc */</span>, <span class="keywordtype">char</span> * <span class="comment">/* argv */</span>[])
{
    <span class="keywordflow">try</span>
    {
        <span class="comment">// 1. Create a database instance on memory, so use memory_database</span>

        <span class="keywordtype">unsigned</span>                        flags   =   0;  <span class="comment">// No special flags here.</span>
        <a class="code" href="classopenrj_1_1cpp_1_1_memory_database.html">openrj::cpp::MemoryDatabase</a>     db(&amp;contents[0], <span class="keyword">sizeof</span>(contents), flags);

        <span class="comment">// 2. Display database characteristics</span>

        cout &lt;&lt; endl &lt;&lt; <span class="stringliteral">"2. Display database characteristics:"</span> &lt;&lt; endl;

        cout    &lt;&lt; <span class="stringliteral">"Database has "</span> 
                &lt;&lt; db.GetNumLines() &lt;&lt; <span class="stringliteral">" lines in "</span> 
                &lt;&lt; db.GetNumFields() &lt;&lt; <span class="stringliteral">" fields in "</span>
                &lt;&lt; db.GetNumRecords() &lt;&lt; <span class="stringliteral">" records"</span>
                &lt;&lt; endl;

        <span class="comment">// 3. Enumerate the contents using subscript operators</span>

        cout &lt;&lt; endl &lt;&lt; <span class="stringliteral">"3. Enumerate records and their fields using subscript operators:"</span> &lt;&lt; endl;

        { <span class="keywordflow">for</span>(size_t iRecord = 0; iRecord &lt; db.GetNumRecords(); ++iRecord)
        {
            <a class="code" href="classopenrj_1_1cpp_1_1_record.html">openrj::cpp::Record</a> record(db[iRecord]);

            cout    &lt;&lt; <span class="stringliteral">"record-#"</span> &lt;&lt; iRecord
                    &lt;&lt; <span class="stringliteral">" "</span> &lt;&lt; record.GetComment() &lt;&lt; <span class="stringliteral">" "</span>
                    &lt;&lt; <span class="stringliteral">" ("</span> &lt;&lt; db.GetNumRecords() &lt;&lt; <span class="stringliteral">" fields)"</span>
                    &lt;&lt; endl;

            <span class="keywordflow">for</span>(size_t iField = 0; iField &lt; record.GetNumFields(); ++iField)
            {
                <a class="code" href="classopenrj_1_1cpp_1_1_field.html">openrj::cpp::Field</a>  field(record[iField]);
                std::string         name    =   field.GetName();
                std::string         value   =   field.GetValue();

                cout &lt;&lt; <span class="stringliteral">"  field-#"</span> &lt;&lt; iField &lt;&lt; <span class="stringliteral">": "</span> &lt;&lt; field &lt;&lt; endl;
            }
        }}
    }
    <span class="keywordflow">catch</span>(std::exception &amp;x)
    {
        cerr &lt;&lt; <span class="stringliteral">"Failed to open database: "</span> &lt;&lt; x.what() &lt;&lt; endl;
    }

    <span class="keywordflow">return</span> EXIT_SUCCESS;
}

<span class="comment">/* /////////////////////////////////////////////////////////////////////////////</span>
<span class="comment"> * end of file</span>
<span class="comment"> */</span>
</pre></div><h3><a class="anchor" name="subsection_sample_Cpp_Cpp_full">
Cpp_full</a></h3>
This sample/test program, located in the <b>test/Cpp_full</b> subdirectory, shows a full use of the Cpp-API, including error-handling and use of the FileDatabase class to load a file named on the command-line. It also allows the specification of the ORJ_FLAG_ORDERFIELDS and/or ORJ_FLAG_ELIDEBLANKRECORDS flags, via the command-line, which can moderate the database contents as expressed by the API.<p>
This program has various aspects that are peripheral to the quick absorption of the mapping, and should be examined and tested after <a class="el" href="page_using_cpp.html#subsection_sample_Cpp_Cpp_simple">Cpp_simple</a>.<p>
<div class="fragment"><pre class="fragment"><span class="comment">/* /////////////////////////////////////////////////////////////////////////////</span>
<span class="comment"> * File:        Cpp_full.cpp</span>
<span class="comment"> *</span>
<span class="comment"> * Purpose:     C++ test program for the Open-RJ/C++ (the C++ mapping of the</span>
<span class="comment"> *              Open-RJ library).</span>
<span class="comment"> *</span>
<span class="comment"> * Created:     15th June 2004</span>
<span class="comment"> * Updated:     28th June 2005</span>
<span class="comment"> *</span>
<span class="comment"> * www:         http://www.openrj.org/</span>
<span class="comment"> *</span>
<span class="comment"> * Thanks:      To Rajiv Bhagwat for pointing out that the test programs left</span>
<span class="comment"> *              much to be desired in terms of discoverability.</span>
<span class="comment"> *</span>
<span class="comment"> * License:     Copyright 2004-2005, Synesis Software Pty Ltd.</span>
<span class="comment"> *              All rights reserved.</span>
<span class="comment"> *</span>
<span class="comment"> *              (Licensed under the Synesis Software Open License)</span>
<span class="comment"> *</span>
<span class="comment"> *              This source code is placed into the public domain 2004</span>
<span class="comment"> *              by Synesis Software Pty Ltd. There are no restrictions</span>
<span class="comment"> *              whatsoever to your use of the software.</span>
<span class="comment"> *</span>
<span class="comment"> * ////////////////////////////////////////////////////////////////////////// */</span>


<span class="comment">/* Customise the test program as follows: */</span>

<span class="comment">/* 1. USE_MEMORY_DATABASE</span>
<span class="comment"> *</span>
<span class="comment"> * Enable this to use a MemoryDatabase, rather than a FileDatabase on the file</span>
<span class="comment"> * specified in the command-line.</span>
<span class="comment"> *</span>
<span class="comment"> */</span>
<span class="comment">/* #define USE_MEMORY_DATABASE */</span>   

<span class="comment">/* 2. USE_STD_EXCEPTION_ONLY</span>
<span class="comment"> *</span>
<span class="comment"> * Enable this to catch any exceptions from the API via std::exception rather</span>
<span class="comment"> * than openrj::cpp::DatabaseException.</span>
<span class="comment"> */</span>
<span class="comment">/* #define USE_STD_EXCEPTION_ONLY */</span>   


<span class="comment">/* Open-RJ Header Files */</span>
<span class="preprocessor">#include &lt;<a class="code" href="cpp_2database_8hpp.html">openrj/cpp/database.hpp</a>&gt;</span>

<span class="comment">/* Standard C++ Library Files */</span>
<span class="preprocessor">#include &lt;iostream&gt;</span>

<span class="comment">/* Standard C Library Files */</span>
<span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<span class="preprocessor">#include &lt;string.h&gt;</span>

<span class="comment">/* /////////////////////////////////////////////////////////////////////////////</span>
<span class="comment"> * Namespace</span>
<span class="comment"> */</span>

<span class="keyword">using</span> std::cerr;
<span class="keyword">using</span> std::endl;
<span class="keyword">using</span> std::cout;

<span class="comment">/* /////////////////////////////////////////////////////////////////////////////</span>
<span class="comment"> * Helper function declarations</span>
<span class="comment"> */</span>

<span class="keyword">static</span> <span class="keywordtype">void</span> usage(<span class="keywordtype">int</span> bExit, <span class="keywordtype">char</span> <span class="keyword">const</span> *reason, <span class="keywordtype">int</span> invalidArg, <span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[]);
<span class="keyword">static</span> <span class="keywordtype">int</span>  run_unittests();
<span class="keyword">static</span> <span class="keywordtype">int</span>  execute_unittest(<a class="code" href="classopenrj_1_1cpp_1_1_database_base.html">openrj::cpp::DatabaseBase</a> <span class="keyword">const</span> &amp;database);

<span class="comment">/* ////////////////////////////////////////////////////////////////////////// */</span>

<span class="keyword">static</span> <span class="keywordtype">int</span> main_(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])
{
    <span class="keywordtype">int</span>         i;
    <span class="keywordtype">char</span> <span class="keyword">const</span>  *jarName    =   NULL;
    <span class="keywordtype">unsigned</span>    flags       =   0;

    <span class="comment">/* Parse the command-line arguments, to specify the . */</span>
    <span class="keywordflow">for</span>(i = 1; i &lt; argc; ++i)
    {
        <span class="keyword">const</span> <span class="keywordtype">char</span>  *arg    =   argv[i];

        <span class="keywordflow">if</span>(arg[0] == <span class="charliteral">'-'</span>)
        {
            <span class="keywordflow">if</span>(arg[1] == <span class="charliteral">'-'</span>)
            {
                <span class="comment">/* -- arguments */</span>
                <span class="keywordflow">if</span>( 0 == strcmp(<span class="stringliteral">"unittest"</span>, arg + 2) ||
                    0 == strcmp(<span class="stringliteral">"unittests"</span>, arg + 2))
                {
                    <span class="keywordflow">return</span> run_unittests();
                }
                <span class="keywordflow">else</span>
                {
                    usage(1, <span class="stringliteral">"Invalid argument(s) specified"</span>, i, argc, argv);
                }
            }
            <span class="keywordflow">else</span>
            {
                <span class="comment">/* - arguments */</span>
                <span class="keywordflow">switch</span>(arg[1])
                {
                    <span class="keywordflow">case</span>    <span class="charliteral">'?'</span>:
                        usage(1, NULL, -1, argc, argv);
                        <span class="keywordflow">break</span>;
                    <span class="keywordflow">case</span>    <span class="charliteral">'o'</span>:
                        flags |= <a class="code" href="namespaceopenrj.html#a63a5">openrj::ORJ_FLAG_ORDERFIELDS</a>;
                        <span class="keywordflow">break</span>;
                    <span class="keywordflow">case</span>    <span class="charliteral">'s'</span>:
                        flags |= <a class="code" href="namespaceopenrj.html#a63a6">openrj::ORJ_FLAG_ELIDEBLANKRECORDS</a>;
                        <span class="keywordflow">break</span>;
                    <span class="keywordflow">default</span>:
                        usage(1, <span class="stringliteral">"Invalid argument(s) specified"</span>, i, argc, argv);
                        <span class="keywordflow">break</span>;
                }
            }
        }
        <span class="keywordflow">else</span>
        {
            <span class="comment">/* other arguments */</span>
            <span class="keywordflow">if</span>(NULL == jarName)
            {
                jarName = arg;
            }
            <span class="keywordflow">else</span>
            {
                usage(1, <span class="stringliteral">"Invalid argument(s) specified"</span>, i, argc, argv);
            }
        }
    }

<span class="preprocessor">#ifndef USE_MEMORY_DATABASE</span>
<span class="preprocessor"></span>    <span class="keywordflow">if</span>(NULL == jarName)
    {
        usage(1, <span class="stringliteral">"Must specify a JAR name"</span>, -1, argc, argv);
    }
    <span class="keywordflow">else</span>
<span class="preprocessor">#endif </span><span class="comment">/* !USE_MEMORY_DATABASE */</span>
    {
        <span class="comment">/* Here's where the use of the library starts. */</span>

        <span class="keyword">using</span> <span class="keyword">namespace </span>openrj::cpp;

        <span class="keywordflow">try</span>
        {
<span class="preprocessor">#ifdef USE_MEMORY_DATABASE</span>
<span class="preprocessor"></span>
            <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span>   contents[] =

                <span class="stringliteral">"%% Sample Open-RJ database - Cats and Dogs\n"</span>
                <span class="stringliteral">"%% Created:   28th September 2004\n"</span>
                <span class="stringliteral">"%% Updated:   29th September 2004\n"</span>
                <span class="stringliteral">"Name:      Barney\n"</span>
                <span class="stringliteral">"Species:   Dog\n"</span>
                <span class="stringliteral">"Breed:     Bijon \\\n"</span>
                <span class="stringliteral">"           Frieze\n"</span>
                <span class="stringliteral">"%%\n"</span>
                <span class="stringliteral">"Name:      Elsa\n"</span>
                <span class="stringliteral">"Species:   Dog\n"</span>
                <span class="stringliteral">"Breed:     Mixed\n"</span>
                <span class="stringliteral">"%%\n"</span>
                <span class="stringliteral">"Name:      Fluffy Kitten\n"</span>
                <span class="stringliteral">"Species:   Cat\n"</span>
                <span class="stringliteral">"%%\n"</span>
                <span class="stringliteral">"Name:      Moet\n"</span>
                <span class="stringliteral">"Species:   Dog\n"</span>
                <span class="stringliteral">"Breed:     Boxer\n"</span>
                <span class="stringliteral">"%%\n"</span>
                <span class="stringliteral">"Name:      Rebel\n"</span>
                <span class="stringliteral">"Species:   Dog\n"</span>
                <span class="stringliteral">"Breed:     German \\\n"</span>
                <span class="stringliteral">"           Shepherd\n"</span>
                <span class="stringliteral">"%%\n"</span>
<span class="preprocessor">#if !defined(__GNUC__)</span>
<span class="preprocessor"></span>                <span class="stringliteral">"Name:      Pepper\n"</span>
                <span class="stringliteral">"Species:   Dog\n"</span>
                <span class="stringliteral">"Breed:     Border Collie\n"</span>
                <span class="stringliteral">"%%\n"</span>
                <span class="stringliteral">"Name:      Samson\n"</span>
                <span class="stringliteral">"Species:   Dog\n"</span>
                <span class="stringliteral">"Breed:     Ridgeback\n"</span>
                <span class="stringliteral">"%%\n"</span>
                <span class="stringliteral">"Name:      Sheltie\n"</span>
                <span class="stringliteral">"Species:   Dog\n"</span>
                <span class="stringliteral">"Breed:     Shetland \\\n"</span>
                <span class="stringliteral">"           Sheepdog\n"</span>
                <span class="stringliteral">"%%\n"</span>
<span class="preprocessor">#endif </span><span class="comment">/* compiler */</span>
                <span class="stringliteral">"Name:      Sparky\n"</span>
                <span class="stringliteral">"Species:   Cat\n"</span>
                <span class="stringliteral">"%%\n"</span>;

            MemoryDatabase  db(&amp;contents[0], <span class="keyword">sizeof</span>(contents), flags);

<span class="preprocessor">#else </span><span class="comment">/* ? USE_MEMORY_DATABASE */</span>

            FileDatabase    db(jarName, flags);

<span class="preprocessor">#endif </span><span class="comment">/* USE_MEMORY_DATABASE */</span>

            cout    &lt;&lt; <span class="stringliteral">"Record-JAR "</span> &lt;&lt; jarName &lt;&lt; <span class="stringliteral">" has "</span>
                    &lt;&lt; db.GetNumLines() &lt;&lt; <span class="stringliteral">" lines in "</span>
                    &lt;&lt; db.GetNumFields() &lt;&lt; <span class="stringliteral">" fields in "</span>
                    &lt;&lt; db.GetNumRecords() &lt;&lt; <span class="stringliteral">" records"</span>
                    &lt;&lt; endl;

            <span class="keywordflow">for</span>(size_t iRecord = 0; iRecord &lt; db.GetNumRecords(); ++iRecord)
            {
                size_t  iField;
                Record  record(db[iRecord]);

                cout    &lt;&lt; <span class="stringliteral">"record-#"</span> &lt;&lt; iRecord 
                        &lt;&lt; <span class="stringliteral">" "</span> &lt;&lt; record.GetComment() &lt;&lt; <span class="stringliteral">" "</span>
                        &lt;&lt; <span class="stringliteral">" ("</span> &lt;&lt; db.GetNumRecords() &lt;&lt; <span class="stringliteral">" fields)"</span>
                        &lt;&lt; endl;

                <span class="keywordflow">for</span>(iField = 0; iField &lt; record.GetNumFields(); ++iField)
                {
                    Field       field(record[iField]);
                    <span class="keywordtype">char</span> <span class="keyword">const</span>  *name   =   field.GetName();
                    <span class="keywordtype">char</span> <span class="keyword">const</span>  *value  =   field.GetValue();

                    cout    &lt;&lt; <span class="stringliteral">"  field-#"</span> &lt;&lt; iField &lt;&lt; <span class="stringliteral">" "</span> &lt;&lt; field
                            &lt;&lt; <span class="stringliteral">" (name="</span> &lt;&lt; name &lt;&lt; <span class="stringliteral">"; value="</span> &lt;&lt; value &lt;&lt; <span class="stringliteral">")"</span>
                            &lt;&lt; endl;
                }
            }
        }
<span class="preprocessor">#ifdef USE_STD_EXCEPTION_ONLY</span>
<span class="preprocessor"></span>        <span class="keywordflow">catch</span>(std::exception &amp;x)
        {
            cerr &lt;&lt; <span class="stringliteral">"Failed to open database: "</span> &lt;&lt; x.what() &lt;&lt; endl;
        }
<span class="preprocessor">#else </span><span class="comment">/* ? USE_STD_EXCEPTION_ONLY */</span>
        <span class="keywordflow">catch</span>(<a class="code" href="classopenrj_1_1cpp_1_1_database_exception.html">openrj::cpp::DatabaseException</a> &amp;x)
        {
            <a class="code" href="namespaceopenrj.html#a64">openrj::ORJRC</a>   rc = x.rc();

            <span class="keywordflow">if</span>(0 != rc)
            {
                <span class="keywordflow">switch</span>(rc)
                {
                    <span class="keywordflow">case</span>    <a class="code" href="namespaceopenrj.html#a64a10">openrj::ORJ_RC_CANNOTOPENJARFILE</a>:
                        cerr &lt;&lt; <span class="stringliteral">"Cannot open file: "</span> &lt;&lt; jarName &lt;&lt; endl;
                        <span class="keywordflow">break</span>;
                    <span class="keywordflow">case</span>    <a class="code" href="namespaceopenrj.html#a64a14">openrj::ORJ_RC_PARSEERROR</a>:
                        cerr    &lt;&lt; <span class="stringliteral">"Error in "</span> &lt;&lt; jarName
                                &lt;&lt; <span class="stringliteral">" at line "</span> &lt;&lt; x.error().invalidLine
                                &lt;&lt; <span class="stringliteral">", column "</span> &lt;&lt; x.error().invalidColumn
                                &lt;&lt; <span class="stringliteral">"; "</span> &lt;&lt;  <a class="code" href="group__group__openrj__stringaccessshims.html#ga1">stlsoft::c_str_ptr</a>(x.error().parseError)
                                &lt;&lt; endl;
                        <span class="keywordflow">break</span>;
                    <span class="keywordflow">default</span>:
                        <span class="keywordflow">break</span>;
                }
            }
        }
<span class="preprocessor">#endif </span><span class="comment">/* USE_STD_EXCEPTION_ONLY */</span>
    }

    <span class="keywordflow">return</span> EXIT_SUCCESS;
}

<span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])
{
<span class="preprocessor">#if 0</span>
<span class="preprocessor"></span>    Sleep(100000);
<span class="preprocessor">#endif </span><span class="comment">/* 0 */</span>

    <span class="keywordflow">try</span>
    {
        <span class="keywordflow">return</span> main_(argc, argv);
    }
    <span class="keywordflow">catch</span>(std::exception &amp;x)
    {
        cerr &lt;&lt; <span class="stringliteral">"Unhandled error: "</span> &lt;&lt; x.what() &lt;&lt; endl;
    }
    <span class="keywordflow">catch</span>(...)
    {
        cerr &lt;&lt; <span class="stringliteral">"Unhandled unknown error"</span> &lt;&lt; endl;
    }

    <span class="keywordflow">return</span> EXIT_FAILURE;
}

<span class="comment">/* ////////////////////////////////////////////////////////////////////////// */</span>

<span class="preprocessor">#if defined(__GNUC__)</span>
<span class="preprocessor"></span><span class="preprocessor"># ifdef alloca</span>
<span class="preprocessor"></span><span class="preprocessor">#  undef alloca</span>
<span class="preprocessor"></span><span class="preprocessor"># endif </span><span class="comment">/* !alloca */</span>
<span class="preprocessor"># define alloca             __builtin_alloca</span>
<span class="preprocessor"></span><span class="preprocessor">#elif defined(WIN32)</span>
<span class="preprocessor"></span><span class="preprocessor"># include &lt;malloc.h&gt;</span>
<span class="preprocessor"># ifndef alloca</span>
<span class="preprocessor"></span><span class="preprocessor">#  define alloca            _alloca</span>
<span class="preprocessor"></span><span class="preprocessor"># endif </span><span class="comment">/* !alloca */</span>
<span class="preprocessor">#else </span><span class="comment">/* ? OS */</span>
<span class="preprocessor"># include &lt;alloca.h&gt;</span>
<span class="preprocessor">#endif </span><span class="comment">/* OS */</span>

<span class="keyword">static</span> <span class="keywordtype">void</span> usage(<span class="keywordtype">int</span> bExit, <span class="keywordtype">char</span> <span class="keyword">const</span> *reason, <span class="keywordtype">int</span> invalidArg, <span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])
{
    <span class="keywordtype">char</span>    *EXE_NAME   =   strcpy(static_cast&lt;char*&gt;(alloca(1 + strlen(argv[0]))), argv[0]);
    <span class="keywordtype">char</span>    *p;

    <span class="keywordflow">if</span>(NULL != (p = strrchr(EXE_NAME, <span class="charliteral">'\\'</span>)))
    {
        0[(EXE_NAME = p + 1) - 1] = <span class="charliteral">'\0'</span>;
    }

    <span class="keywordflow">if</span>(NULL != (p = strrchr(EXE_NAME, <span class="charliteral">'/'</span>)))
    {
        0[(EXE_NAME = p + 1) - 1] = <span class="charliteral">'\0'</span>;
    }

    cerr &lt;&lt; <span class="stringliteral">""</span> &lt;&lt; endl;
    cerr &lt;&lt; <span class="stringliteral">"  Open-RJ C++ test program: "</span> &lt;&lt; EXE_NAME &lt;&lt; endl;;
    cerr &lt;&lt; <span class="stringliteral">""</span> &lt;&lt; endl;

    stlsoft_assert(invalidArg &lt; argc);

    <span class="keywordflow">if</span>(NULL != reason)
    {
        cerr &lt;&lt; <span class="stringliteral">"  Error: "</span> &lt;&lt; reason &lt;&lt; <span class="stringliteral">""</span> &lt;&lt; endl;
        cerr &lt;&lt; <span class="stringliteral">""</span> &lt;&lt; endl;
    }

    <span class="keywordflow">if</span>(0 &lt; invalidArg)
    {
        cerr &lt;&lt; <span class="stringliteral">"  First invalid argument #"</span> &lt;&lt; invalidArg &lt;&lt; <span class="stringliteral">": "</span> &lt;&lt; argv[invalidArg] &lt;&lt; endl;
        cerr &lt;&lt; <span class="stringliteral">"  Arguments were (first bad marked *):"</span> &lt;&lt; endl &lt;&lt; endl;
        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 1; i &lt; argc; ++i)
        {
            cerr &lt;&lt; <span class="stringliteral">"  "</span> &lt;&lt; ((i == invalidArg) ? <span class="stringliteral">"* "</span> : <span class="stringliteral">"  "</span>) &lt;&lt; argv[i] &lt;&lt; endl;
        }
        cerr &lt;&lt; <span class="stringliteral">""</span> &lt;&lt; endl;
    }

    cerr &lt;&lt; <span class="stringliteral">"  USAGE 1: "</span> &lt;&lt; EXE_NAME &lt;&lt; <span class="stringliteral">" [-o] [-s] &lt;database&gt;"</span> &lt;&lt; endl;
    cerr &lt;&lt; <span class="stringliteral">""</span> &lt;&lt; endl;
    cerr &lt;&lt; <span class="stringliteral">"    -o            -   orders the fields within each record"</span> &lt;&lt; endl;
    cerr &lt;&lt; <span class="stringliteral">"    -s            -   elide blank records from the database"</span> &lt;&lt; endl;
    cerr &lt;&lt; <span class="stringliteral">"    &lt;database&gt;    -   the Open-RJ database file"</span> &lt;&lt; endl;
    cerr &lt;&lt; <span class="stringliteral">""</span> &lt;&lt; endl;
    cerr &lt;&lt; <span class="stringliteral">"    Converts the &lt;input-file&gt; to the &lt;output-file&gt; by either"</span> &lt;&lt; endl;
    cerr &lt;&lt; <span class="stringliteral">"    Base-64 encoding (-e) or Base-64 decoding (-d)"</span> &lt;&lt; endl;
    cerr &lt;&lt; <span class="stringliteral">""</span> &lt;&lt; endl;
    cerr &lt;&lt; <span class="stringliteral">"  USAGE 2: "</span> &lt;&lt; EXE_NAME &lt;&lt; <span class="stringliteral">" --unittest"</span> &lt;&lt; endl;
    cerr &lt;&lt; <span class="stringliteral">""</span> &lt;&lt; endl;
    cerr &lt;&lt; <span class="stringliteral">"    Runs internal tests, returning 0 if all succeed, non-0 otherwise"</span> &lt;&lt; endl;
    cerr &lt;&lt; <span class="stringliteral">""</span> &lt;&lt; endl;
    cerr &lt;&lt; <span class="stringliteral">"  USAGE 3: "</span> &lt;&lt; EXE_NAME &lt;&lt; <span class="stringliteral">" -?"</span> &lt;&lt; endl;
    cerr &lt;&lt; <span class="stringliteral">""</span> &lt;&lt; endl;
    cerr &lt;&lt; <span class="stringliteral">"    Displays this help"</span> &lt;&lt; endl;
    cerr &lt;&lt; <span class="stringliteral">""</span> &lt;&lt; endl;

    <span class="keywordflow">if</span>(bExit)
    {
        exit(EXIT_FAILURE);
    }
}

<span class="keyword">static</span> <span class="keywordtype">int</span> execute_unittest(<a class="code" href="classopenrj_1_1cpp_1_1_database_base.html">openrj::cpp::DatabaseBase</a> <span class="keyword">const</span> &amp;database)
{
    <span class="comment">/* 1. Check that the database thinks it has the same number of total</span>
<span class="comment">     * fields as the total of each record</span>
<span class="comment">     */</span>
    size_t  numFields1  =   database.<a class="code" href="classopenrj_1_1cpp_1_1_database_base.html#openrj_1_1cpp_1_1_memory_databasez9_1">GetNumFields</a>();
    size_t  numFields2  =   0;

    { <span class="keywordflow">for</span>(size_t i = 0; i &lt; database.<a class="code" href="classopenrj_1_1cpp_1_1_database_base.html#openrj_1_1cpp_1_1_memory_databasez9_2">GetNumRecords</a>(); ++i)
    {
        numFields2 += database[i].<a class="code" href="classopenrj_1_1cpp_1_1_database_base.html#openrj_1_1cpp_1_1_memory_databasez9_1">GetNumFields</a>();
    }}

    <span class="keywordflow">if</span>(numFields1 != numFields2)
    {
        cerr &lt;&lt; <span class="stringliteral">"DatabaseBase::GetNumFields(): "</span> &lt;&lt; numFields1 &lt;&lt; <span class="stringliteral">"; n x Record::GetNumFields(): "</span> &lt;&lt; numFields2 &lt;&lt; endl;

        <span class="keywordflow">return</span> 1;
    }

    <span class="comment">/* NOTE: Other tests not yet implemented */</span>

    <span class="keywordflow">return</span> 0;
}

<span class="keyword">static</span> <span class="keywordtype">int</span> run_unittests()
{
    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span>   contents[] =

        <span class="stringliteral">"%% Sample Open-RJ database - Cats and Dogs\n"</span>
        <span class="stringliteral">"%% Created:   28th September 2004\n"</span>
        <span class="stringliteral">"%% Updated:   29th September 2004\n"</span>
        <span class="stringliteral">"Name:      Barney\n"</span>
        <span class="stringliteral">"Species:   Dog\n"</span>
        <span class="stringliteral">"Breed:     Bijon \\\n"</span>
        <span class="stringliteral">"           Frieze\n"</span>
        <span class="stringliteral">"%%\n"</span>
        <span class="stringliteral">"Name:      Elsa\n"</span>
        <span class="stringliteral">"Species:   Dog\n"</span>
        <span class="stringliteral">"Breed:     Mixed\n"</span>
        <span class="stringliteral">"%%\n"</span>
        <span class="stringliteral">"Name:      Fluffy Kitten\n"</span>
        <span class="stringliteral">"Species:   Cat\n"</span>
        <span class="stringliteral">"%%\n"</span>
        <span class="stringliteral">"Name:      Moet\n"</span>
        <span class="stringliteral">"Species:   Dog\n"</span>
        <span class="stringliteral">"Breed:     Boxer\n"</span>
        <span class="stringliteral">"%%\n"</span>
        <span class="stringliteral">"Name:      Rebel\n"</span>
        <span class="stringliteral">"Species:   Dog\n"</span>
        <span class="stringliteral">"Breed:     German \\\n"</span>
        <span class="stringliteral">"           Shepherd\n"</span>
        <span class="stringliteral">"%%\n"</span>
<span class="preprocessor">#if !defined(__GNUC__)</span>
<span class="preprocessor"></span>        <span class="stringliteral">"Name:      Pepper\n"</span>
        <span class="stringliteral">"Species:   Dog\n"</span>
        <span class="stringliteral">"Breed:     Border Collie\n"</span>
        <span class="stringliteral">"%%\n"</span>
        <span class="stringliteral">"Name:      Samson\n"</span>
        <span class="stringliteral">"Species:   Dog\n"</span>
        <span class="stringliteral">"Breed:     Ridgeback\n"</span>
        <span class="stringliteral">"%%\n"</span>
        <span class="stringliteral">"Name:      Sheltie\n"</span>
        <span class="stringliteral">"Species:   Dog\n"</span>
        <span class="stringliteral">"Breed:     Shetland \\\n"</span>
        <span class="stringliteral">"           Sheepdog\n"</span>
        <span class="stringliteral">"%%\n"</span>
<span class="preprocessor">#endif </span><span class="comment">/* compiler */</span>
        <span class="stringliteral">"Name:      Sparky\n"</span>
        <span class="stringliteral">"Species:   Cat\n"</span>
        <span class="stringliteral">"%%\n"</span>;
<span class="preprocessor">#if !defined(__GNUC__)</span>
<span class="preprocessor"></span>    <span class="keyword">static</span> <span class="keyword">const</span> size_t NUM_RECORDS =   12;
    <span class="keyword">static</span> <span class="keyword">const</span> size_t NUM_FIELDS  =   25;
<span class="preprocessor">#else </span><span class="comment">/* ?  compiler */</span>
    <span class="keyword">static</span> <span class="keyword">const</span> size_t NUM_RECORDS =   9;
    <span class="keyword">static</span> <span class="keyword">const</span> size_t NUM_FIELDS  =   16;
<span class="preprocessor">#endif </span><span class="comment">/* compiler */</span>

    <span class="comment">/* 1. Test that *not* eliding blanks gives the right number of records */</span>
    <span class="keywordflow">try</span>
    {
        <a class="code" href="classopenrj_1_1cpp_1_1_memory_database.html">openrj::cpp::MemoryDatabase</a>     <a class="code" href="namespaceopenrj_1_1stl.html#a0">database</a>(&amp;contents[0], <span class="keyword">sizeof</span>(contents), 0);

        <span class="keywordtype">int</span> iRet = 0;

        <span class="keywordflow">if</span>(NUM_RECORDS != database.<a class="code" href="classopenrj_1_1cpp_1_1_database_base.html#openrj_1_1cpp_1_1_memory_databasez9_2">GetNumRecords</a>())
        {
            cerr &lt;&lt; <span class="stringliteral">"Incorrect number of records"</span> &lt;&lt; endl;

            iRet = 1;
        }
        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(NUM_FIELDS != database.<a class="code" href="classopenrj_1_1cpp_1_1_database_base.html#openrj_1_1cpp_1_1_memory_databasez9_1">GetNumFields</a>())
        {
            cerr &lt;&lt; <span class="stringliteral">"Incorrect number of fields"</span> &lt;&lt; endl;

            iRet = 1;
        }
        <span class="keywordflow">else</span>
        {
            <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span>    NUM_TESTS   =   1000;
            <span class="keywordtype">int</span>                 i;

            <span class="keywordflow">for</span>(i = 0; i &lt; NUM_TESTS; ++i)
            {
                iRet = execute_unittest(database);

                <span class="keywordflow">if</span>(0 != iRet)
                {
                    <span class="keywordflow">break</span>;
                }
            }

            <span class="keywordflow">if</span>(0 == iRet)
            {
                cerr &lt;&lt; NUM_TESTS &lt;&lt; <span class="stringliteral">" tests succeeded"</span> &lt;&lt; endl;
            }
            <span class="keywordflow">else</span>
            {
                cerr &lt;&lt; <span class="stringliteral">"Test #"</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">" failed"</span> &lt;&lt; endl;
            }
        }

        <span class="keywordflow">return</span> (0 == iRet) ? EXIT_SUCCESS : EXIT_FAILURE;
    }
    <span class="keywordflow">catch</span>(std::exception &amp;x)
    {
        cout &lt;&lt; <span class="stringliteral">"Failed: "</span> &lt;&lt; x.what() &lt;&lt; endl;

        <span class="keywordflow">return</span> EXIT_FAILURE;
    }
}

<span class="comment">/* /////////////////////////////////////////////////////////////////////////////</span>
<span class="comment"> * end of file</span>
<span class="comment"> */</span>
</pre></div><h3><a class="anchor" name="subsection_sample_STL_STL_simple">
STL_simple</a></h3>
This sample/test program, located in the <b>test/STL_simple</b> subdirectory, shows a minimal use of the mapping, to load a memory database (from a literal string), display information about the database (# of lines, fields, records), and then enumerate the records and their constituent fields.<p>
<div class="fragment"><pre class="fragment"><span class="comment">/* /////////////////////////////////////////////////////////////////////////////</span>
<span class="comment"> * File:        STL_simple.cpp</span>
<span class="comment"> *</span>
<span class="comment"> * Purpose:     C++ test program for the Open-RJ/STL (the STL mapping of the</span>
<span class="comment"> *              Open-RJ library). This program uses the memory_database class</span>
<span class="comment"> *              and attempts to be a smallest-possible informative example.</span>
<span class="comment"> *</span>
<span class="comment"> * Created:     24th May 2005</span>
<span class="comment"> * Updated:     19th June 2005</span>
<span class="comment"> *</span>
<span class="comment"> * www:         http://www.openrj.org/</span>
<span class="comment"> *</span>
<span class="comment"> * Thanks:      To Rajiv Bhagwat for pointing out that the test programs left</span>
<span class="comment"> *              much to be desired in terms of discoverability.</span>
<span class="comment"> *</span>
<span class="comment"> * License:     Copyright 2005, Synesis Software Pty Ltd.</span>
<span class="comment"> *              All rights reserved.</span>
<span class="comment"> *</span>
<span class="comment"> *              (Licensed under the Synesis Software Open License)</span>
<span class="comment"> *</span>
<span class="comment"> *              This source code is placed into the public domain 2005</span>
<span class="comment"> *              by Synesis Software Pty Ltd. There are no restrictions</span>
<span class="comment"> *              whatsoever to your use of the software.</span>
<span class="comment"> *</span>
<span class="comment"> * ////////////////////////////////////////////////////////////////////////// */</span>


<span class="comment">/* Open-RJ Header Files */</span>
<span class="preprocessor">#include &lt;<a class="code" href="stl_2database_8hpp.html">openrj/stl/database.hpp</a>&gt;</span>

<span class="comment">/* Standard C++ Library Files */</span>
<span class="preprocessor">#include &lt;iostream&gt;</span>

<span class="comment">/* /////////////////////////////////////////////////////////////////////////////</span>
<span class="comment"> * Namespace</span>
<span class="comment"> */</span>

<span class="keyword">using</span> std::cerr;
<span class="keyword">using</span> std::endl;
<span class="keyword">using</span> std::cout;

<span class="comment">/* /////////////////////////////////////////////////////////////////////////////</span>
<span class="comment"> * Globals</span>
<span class="comment"> */</span>

<span class="comment">// Sample database</span>
<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span>   contents[] =

    <span class="stringliteral">"%% Sample Open-RJ database - Cats and Dogs\n"</span>
    <span class="stringliteral">"%% Created:   28th September 2004\n"</span>
    <span class="stringliteral">"%% Updated:   29th September 2004\n"</span>
    <span class="stringliteral">"Name:      Barney\n"</span>
    <span class="stringliteral">"Species:   Dog\n"</span>
    <span class="stringliteral">"Breed:     Bijon \\\n"</span>
    <span class="stringliteral">"           Frieze\n"</span>
    <span class="stringliteral">"%%\n"</span>
    <span class="stringliteral">"Name:      Elsa\n"</span>
    <span class="stringliteral">"Species:   Dog\n"</span>
    <span class="stringliteral">"Breed:     Mixed\n"</span>
    <span class="stringliteral">"%%\n"</span>
    <span class="stringliteral">"Name:      Fluffy Kitten\n"</span>
    <span class="stringliteral">"Species:   Cat\n"</span>
    <span class="stringliteral">"%%\n"</span>
    <span class="stringliteral">"Name:      Moet\n"</span>
    <span class="stringliteral">"Species:   Dog\n"</span>
    <span class="stringliteral">"Breed:     Boxer\n"</span>
    <span class="stringliteral">"%%\n"</span>
    <span class="stringliteral">"Name:      Rebel\n"</span>
    <span class="stringliteral">"Species:   Dog\n"</span>
    <span class="stringliteral">"Breed:     German \\\n"</span>
    <span class="stringliteral">"           Shepherd\n"</span>
    <span class="stringliteral">"%%\n"</span>
<span class="preprocessor">#if !defined(__GNUC__)</span>
<span class="preprocessor"></span>    <span class="stringliteral">"Name:      Pepper\n"</span>
    <span class="stringliteral">"Species:   Dog\n"</span>
    <span class="stringliteral">"Breed:     Border Collie\n"</span>
    <span class="stringliteral">"%%\n"</span>
    <span class="stringliteral">"Name:      Samson\n"</span>
    <span class="stringliteral">"Species:   Dog\n"</span>
    <span class="stringliteral">"Breed:     Ridgeback\n"</span>
    <span class="stringliteral">"%%\n"</span>
    <span class="stringliteral">"Name:      Sheltie\n"</span>
    <span class="stringliteral">"Species:   Dog\n"</span>
    <span class="stringliteral">"Breed:     Shetland \\\n"</span>
    <span class="stringliteral">"           Sheepdog\n"</span>
    <span class="stringliteral">"%%\n"</span>
<span class="preprocessor">#endif </span><span class="comment">/* compiler */</span>
    <span class="stringliteral">"Name:      Sparky\n"</span>
    <span class="stringliteral">"Species:   Cat\n"</span>
    <span class="stringliteral">"%%\n"</span>;

<span class="comment">/* ////////////////////////////////////////////////////////////////////////// */</span>

<span class="keywordtype">int</span> main(<span class="keywordtype">int</span> <span class="comment">/* argc */</span>, <span class="keywordtype">char</span> * <span class="comment">/* argv */</span>[])
{
    <span class="keywordflow">try</span>
    {
        <span class="comment">// 1. Create a database instance on memory, using openrj::stl::memory_database</span>

        cout &lt;&lt; endl &lt;&lt; <span class="stringliteral">"1. Create a database instance on memory, using openrj::stl::memory_database"</span> &lt;&lt; endl &lt;&lt; endl;

        <span class="keywordtype">unsigned</span>                        flags   =   0;  <span class="comment">// No special flags here.</span>
        <a class="code" href="classopenrj_1_1stl_1_1memory__database.html">openrj::stl::memory_database</a>    db(&amp;contents[0], <span class="keyword">sizeof</span>(contents), flags);

        <span class="comment">// 2. Display database characteristics</span>

        cout &lt;&lt; endl &lt;&lt; <span class="stringliteral">"2. Display database characteristics:"</span> &lt;&lt; endl &lt;&lt; endl;

        cout    &lt;&lt; <span class="stringliteral">"  Database has "</span> 
                &lt;&lt; db.num_lines() &lt;&lt; <span class="stringliteral">" lines in "</span> 
                &lt;&lt; db.num_fields() &lt;&lt; <span class="stringliteral">" fields in "</span>
                &lt;&lt; db.num_records() &lt;&lt; <span class="stringliteral">" records"</span>
                &lt;&lt; endl;

        <span class="comment">// 3. Enumerate the contents using subscript operators</span>

        cout &lt;&lt; endl &lt;&lt; <span class="stringliteral">"3. Enumerate records and their fields using subscript operators:"</span> &lt;&lt; endl &lt;&lt; endl;

        { <span class="keywordflow">for</span>(size_t iRecord = 0; iRecord &lt; db.size(); ++iRecord)
        {
            <a class="code" href="classopenrj_1_1stl_1_1record.html">openrj::stl::record</a> record(db[iRecord]);

            cout    &lt;&lt; <span class="stringliteral">"  record-#"</span> &lt;&lt; iRecord
                    &lt;&lt; <span class="stringliteral">" "</span> &lt;&lt; record.comment() &lt;&lt; <span class="stringliteral">" "</span>
                    &lt;&lt; <span class="stringliteral">" ("</span> &lt;&lt; record.size() &lt;&lt; <span class="stringliteral">" fields)"</span>
                    &lt;&lt; endl;

            <span class="keywordflow">for</span>(size_t iField = 0; iField &lt; record.size(); ++iField)
            {
                <a class="code" href="classopenrj_1_1stl_1_1field.html">openrj::stl::field</a>  field(record[iField]);
                std::string         name    =   field.name();
                std::string         value   =   field.value();

                cout &lt;&lt; <span class="stringliteral">"    field-#"</span> &lt;&lt; iField &lt;&lt; <span class="stringliteral">": "</span> &lt;&lt; field &lt;&lt; endl;
            }
        }}

        <span class="comment">// 4. Enumerate the contents using begin()/end() methods</span>

        cout &lt;&lt; endl &lt;&lt; <span class="stringliteral">"4. Enumerate records and their fields using begin()/end() methods:"</span> &lt;&lt; endl &lt;&lt; endl;

        <a class="code" href="classopenrj_1_1stl_1_1database__base_1_1const__iterator.html">openrj::stl::database_base::const_iterator</a>   begin   =   db.begin();
        <a class="code" href="classopenrj_1_1stl_1_1database__base_1_1const__iterator.html">openrj::stl::database_base::const_iterator</a>   end     =   db.end();

        { <span class="keywordflow">for</span>(; begin != end; ++begin)
        {
            <a class="code" href="classopenrj_1_1stl_1_1record.html">openrj::stl::record</a> record(*begin);

            cout    &lt;&lt; <span class="stringliteral">"  record"</span>
                    &lt;&lt; <span class="stringliteral">" "</span> &lt;&lt; record.comment() &lt;&lt; <span class="stringliteral">" "</span>
                    &lt;&lt; <span class="stringliteral">" ("</span> &lt;&lt; record.size() &lt;&lt; <span class="stringliteral">" fields)"</span>
                    &lt;&lt; endl;

            <a class="code" href="classopenrj_1_1stl_1_1record_1_1const__iterator.html">openrj::stl::record::const_iterator</a> begin   =   record.begin();
            <a class="code" href="classopenrj_1_1stl_1_1record_1_1const__iterator.html">openrj::stl::record::const_iterator</a> end     =   record.end();

            <span class="keywordflow">for</span>(; begin != end; ++begin)
            {
                <a class="code" href="classopenrj_1_1stl_1_1field.html">openrj::stl::field</a>  field(*begin);
                std::string         name    =   field.name();
                std::string         value   =   field.value();

                cout &lt;&lt; <span class="stringliteral">"    field"</span> &lt;&lt; <span class="stringliteral">" "</span> &lt;&lt; field &lt;&lt; endl;
            }
        }}

<span class="preprocessor">#ifndef OPENRJ_STL_DATABASE_NO_FIELD_ITERATORS // Not all compilers support this, so ...</span>
<span class="preprocessor"></span>        <span class="comment">// 5. Enumerate all the fields of the database en bloc</span>

        cout &lt;&lt; endl &lt;&lt; <span class="stringliteral">"5. Enumerate all the fields of the database en bloc:"</span> &lt;&lt; endl &lt;&lt; endl;

        cout &lt;&lt; endl &lt;&lt; <span class="stringliteral">"All fields:"</span> &lt;&lt; endl;
        std::copy(db.fields_begin(), db.fields_end(), std::ostream_iterator&lt;openrj::stl::field&gt;(std::cout, <span class="stringliteral">"\n"</span>));
<span class="preprocessor">#endif </span><span class="comment">/* !OPENRJ_STL_DATABASE_NO_FIELD_ITERATORS */</span>

        <span class="comment">// 6. Carry out some name lookups</span>
        { <span class="keywordflow">for</span>(size_t iRecord = 0; iRecord &lt; db.size(); ++iRecord)
        {
            <a class="code" href="classopenrj_1_1stl_1_1record.html">openrj::stl::record</a> record(db[iRecord]);

            cout    &lt;&lt; <span class="stringliteral">"  record-#"</span> &lt;&lt; iRecord
                    &lt;&lt; <span class="stringliteral">" "</span> &lt;&lt; record.comment() &lt;&lt; <span class="stringliteral">" "</span>
                    &lt;&lt; <span class="stringliteral">" ("</span> &lt;&lt; record.size() &lt;&lt; <span class="stringliteral">" fields)"</span>
                    &lt;&lt; endl;

            <span class="keywordflow">if</span>(record.has_field(<span class="stringliteral">"Breed"</span>))
            {
                <a class="code" href="namespaceopenrj_1_1stl.html#a1">openrj::stl::string_t</a>   value       =   record[<span class="stringliteral">"Breed"</span>];

                cout &lt;&lt; <span class="stringliteral">"    This record has a \"Breed\" field, whose value is "</span> &lt;&lt; value &lt;&lt; endl;
            }
            <span class="keywordflow">else</span>
            {
                cout &lt;&lt; <span class="stringliteral">"    This record does not have a \"Breed\" field"</span> &lt;&lt; endl;
            }

            size_t                  numNames    =   record.count_fields(<span class="stringliteral">"Species"</span>);

            STLSOFT_SUPPRESS_UNUSED(numNames);
        }}
    }
    <span class="keywordflow">catch</span>(std::exception &amp;x)
    {
        cerr &lt;&lt; <span class="stringliteral">"Failed to open database: "</span> &lt;&lt; x.what() &lt;&lt; endl;
    }

    <span class="keywordflow">return</span> EXIT_SUCCESS;
}

<span class="comment">/* /////////////////////////////////////////////////////////////////////////////</span>
<span class="comment"> * end of file</span>
<span class="comment"> */</span>
</pre></div><h3><a class="anchor" name="subsection_sample_STL_STL_full">
STL_full</a></h3>
This sample/test program, located in the <b>test/STL_full</b> subdirectory, shows a full use of the STL-API, including error-handling and use of the file_database class to load a file named on the command-line. It also allows the specification of the ORJ_FLAG_ORDERFIELDS and/or ORJ_FLAG_ELIDEBLANKRECORDS flags, via the command-line, which can moderate the database contents as expressed by the API.<p>
This program has various aspects that are peripheral to the quick absorption of the mapping, and should be examined and tested after <a class="el" href="page_using_cpp.html#subsection_sample_STL_STL_simple">STL_simple</a>.<p>
<div class="fragment"><pre class="fragment"><span class="comment">/* /////////////////////////////////////////////////////////////////////////////</span>
<span class="comment"> * File:        STL_full.cpp</span>
<span class="comment"> *</span>
<span class="comment"> * Purpose:     C++ test program for the Open-RJ/STL (the STL mapping of the</span>
<span class="comment"> *              Open-RJ library).</span>
<span class="comment"> *</span>
<span class="comment"> * Created:     18th June 2004</span>
<span class="comment"> * Updated:     19th June 2005</span>
<span class="comment"> *</span>
<span class="comment"> * www:         http://www.openrj.org/</span>
<span class="comment"> *</span>
<span class="comment"> * Thanks:      To Rajiv Bhagwat for pointing out that the test programs left</span>
<span class="comment"> *              much to be desired in terms of discoverability.</span>
<span class="comment"> *</span>
<span class="comment"> * License:     Copyright 2004-2005, Synesis Software Pty Ltd.</span>
<span class="comment"> *              All rights reserved.</span>
<span class="comment"> *</span>
<span class="comment"> *              (Licensed under the Synesis Software Open License)</span>
<span class="comment"> *</span>
<span class="comment"> *              This source code is placed into the public domain 2004</span>
<span class="comment"> *              by Synesis Software Pty Ltd. There are no restrictions</span>
<span class="comment"> *              whatsoever to your use of the software.</span>
<span class="comment"> *</span>
<span class="comment"> * ////////////////////////////////////////////////////////////////////////// */</span>


<span class="comment">/* Customise the test program as follows: */</span>

<span class="comment">/* 1. USE_MEMORY_DATABASE</span>
<span class="comment"> *</span>
<span class="comment"> * Enable this to use a memory_database, rather than a file_database on the file</span>
<span class="comment"> * specified in the command-line.</span>
<span class="comment"> *</span>
<span class="comment"> */</span>
<span class="comment">/* #define USE_MEMORY_DATABASE */</span>   

<span class="comment">/* 2. USE_STD_EXCEPTION_ONLY</span>
<span class="comment"> *</span>
<span class="comment"> * Enable this to catch any exceptions from the API via std::exception rather</span>
<span class="comment"> * than openrj::stl::database_exception.</span>
<span class="comment"> */</span>
<span class="comment">/* #define USE_STD_EXCEPTION_ONLY */</span>   


<span class="comment">/* Open-RJ Header Files */</span>
<span class="preprocessor">#include &lt;<a class="code" href="stl_2database_8hpp.html">openrj/stl/database.hpp</a>&gt;</span>

<span class="comment">/* Standard C++ Library Files */</span>
<span class="preprocessor">#include &lt;iostream&gt;</span>

<span class="comment">/* Standard C Library Files */</span>
<span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<span class="preprocessor">#include &lt;string.h&gt;</span>

<span class="comment">/* /////////////////////////////////////////////////////////////////////////////</span>
<span class="comment"> * Namespace</span>
<span class="comment"> */</span>

<span class="keyword">using</span> std::cerr;
<span class="keyword">using</span> std::endl;
<span class="keyword">using</span> std::cout;

<span class="comment">/* /////////////////////////////////////////////////////////////////////////////</span>
<span class="comment"> * Helper function declarations</span>
<span class="comment"> */</span>

<span class="keyword">static</span> <span class="keywordtype">void</span> usage(<span class="keywordtype">int</span> bExit, <span class="keywordtype">char</span> <span class="keyword">const</span> *reason, <span class="keywordtype">int</span> invalidArg, <span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[]);
<span class="keyword">static</span> <span class="keywordtype">int</span>  run_unittests();
<span class="keyword">static</span> <span class="keywordtype">int</span>  execute_unittest(<a class="code" href="classopenrj_1_1stl_1_1database__base.html">openrj::stl::database_base</a> <span class="keyword">const</span> &amp;database);

<span class="comment">/* ////////////////////////////////////////////////////////////////////////// */</span>

<span class="keyword">static</span> <span class="keywordtype">int</span> main_(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])
{
    <span class="keywordtype">int</span>         i;
    <span class="keywordtype">char</span> <span class="keyword">const</span>  *jarName    =   NULL;
    <span class="keywordtype">unsigned</span>    flags       =   0;

    <span class="comment">/* Parse the command-line arguments, to specify the . */</span>
    <span class="keywordflow">for</span>(i = 1; i &lt; argc; ++i)
    {
        <span class="keyword">const</span> <span class="keywordtype">char</span>  *arg    =   argv[i];

        <span class="keywordflow">if</span>(arg[0] == <span class="charliteral">'-'</span>)
        {
            <span class="keywordflow">if</span>(arg[1] == <span class="charliteral">'-'</span>)
            {
                <span class="comment">/* -- arguments */</span>
                <span class="keywordflow">if</span>( 0 == strcmp(<span class="stringliteral">"unittest"</span>, arg + 2) ||
                    0 == strcmp(<span class="stringliteral">"unittests"</span>, arg + 2))
                {
                    <span class="keywordflow">return</span> run_unittests();
                }
                <span class="keywordflow">else</span>
                {
                    usage(1, <span class="stringliteral">"Invalid argument(s) specified"</span>, i, argc, argv);
                }
            }
            <span class="keywordflow">else</span>
            {
                <span class="comment">/* - arguments */</span>
                <span class="keywordflow">switch</span>(arg[1])
                {
                    <span class="keywordflow">case</span>    <span class="charliteral">'?'</span>:
                        usage(1, NULL, -1, argc, argv);
                        <span class="keywordflow">break</span>;
                    <span class="keywordflow">case</span>    <span class="charliteral">'o'</span>:
                        flags |= <a class="code" href="namespaceopenrj.html#a63a5">openrj::ORJ_FLAG_ORDERFIELDS</a>;
                        <span class="keywordflow">break</span>;
                    <span class="keywordflow">case</span>    <span class="charliteral">'s'</span>:
                        flags |= <a class="code" href="namespaceopenrj.html#a63a6">openrj::ORJ_FLAG_ELIDEBLANKRECORDS</a>;
                        <span class="keywordflow">break</span>;
                    <span class="keywordflow">default</span>:
                        usage(1, <span class="stringliteral">"Invalid argument(s) specified"</span>, i, argc, argv);
                        <span class="keywordflow">break</span>;
                }
            }
        }
        <span class="keywordflow">else</span>
        {
            <span class="comment">/* other arguments */</span>
            <span class="keywordflow">if</span>(NULL == jarName)
            {
                jarName = arg;
            }
            <span class="keywordflow">else</span>
            {
                usage(1, <span class="stringliteral">"Invalid argument(s) specified"</span>, i, argc, argv);
            }
        }
    }

<span class="preprocessor">#ifndef USE_MEMORY_DATABASE</span>
<span class="preprocessor"></span>    <span class="keywordflow">if</span>(NULL == jarName)
    {
        usage(1, <span class="stringliteral">"Must specify a JAR name"</span>, -1, argc, argv);
    }
    <span class="keywordflow">else</span>
<span class="preprocessor">#endif </span><span class="comment">/* !USE_MEMORY_DATABASE */</span>
    {
        <span class="keywordflow">try</span>
        {
<span class="preprocessor">#ifdef USE_MEMORY_DATABASE</span>
<span class="preprocessor"></span>
            <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span>   contents[] =

                <span class="stringliteral">"%% Sample Open-RJ database - Cats and Dogs\n"</span>
                <span class="stringliteral">"%% Created:   28th September 2004\n"</span>
                <span class="stringliteral">"%% Updated:   29th September 2004\n"</span>
                <span class="stringliteral">"Name:      Barney\n"</span>
                <span class="stringliteral">"Species:   Dog\n"</span>
                <span class="stringliteral">"Breed:     Bijon \\\n"</span>
                <span class="stringliteral">"           Frieze\n"</span>
                <span class="stringliteral">"%%\n"</span>
                <span class="stringliteral">"Name:      Elsa\n"</span>
                <span class="stringliteral">"Species:   Dog\n"</span>
                <span class="stringliteral">"Breed:     Mixed\n"</span>
                <span class="stringliteral">"%%\n"</span>
                <span class="stringliteral">"Name:      Fluffy Kitten\n"</span>
                <span class="stringliteral">"Species:   Cat\n"</span>
                <span class="stringliteral">"%%\n"</span>
                <span class="stringliteral">"Name:      Moet\n"</span>
                <span class="stringliteral">"Species:   Dog\n"</span>
                <span class="stringliteral">"Breed:     Boxer\n"</span>
                <span class="stringliteral">"%%\n"</span>
                <span class="stringliteral">"Name:      Rebel\n"</span>
                <span class="stringliteral">"Species:   Dog\n"</span>
                <span class="stringliteral">"Breed:     German \\\n"</span>
                <span class="stringliteral">"           Shepherd\n"</span>
                <span class="stringliteral">"%%\n"</span>
<span class="preprocessor">#if !defined(__GNUC__)</span>
<span class="preprocessor"></span>                <span class="stringliteral">"Name:      Pepper\n"</span>
                <span class="stringliteral">"Species:   Dog\n"</span>
                <span class="stringliteral">"Breed:     Border Collie\n"</span>
                <span class="stringliteral">"%%\n"</span>
                <span class="stringliteral">"Name:      Samson\n"</span>
                <span class="stringliteral">"Species:   Dog\n"</span>
                <span class="stringliteral">"Breed:     Ridgeback\n"</span>
                <span class="stringliteral">"%%\n"</span>
                <span class="stringliteral">"Name:      Sheltie\n"</span>
                <span class="stringliteral">"Species:   Dog\n"</span>
                <span class="stringliteral">"Breed:     Shetland \\\n"</span>
                <span class="stringliteral">"           Sheepdog\n"</span>
                <span class="stringliteral">"%%\n"</span>
<span class="preprocessor">#endif </span><span class="comment">/* compiler */</span>
                <span class="stringliteral">"Name:      Sparky\n"</span>
                <span class="stringliteral">"Species:   Cat\n"</span>
                <span class="stringliteral">"%%\n"</span>;

            <span class="comment">// 1. Create a database instance on memory, using openrj::stl::memory_database</span>

            cout &lt;&lt; endl &lt;&lt; <span class="stringliteral">"1. Create a database instance on memory, using openrj::stl::memory_database"</span> &lt;&lt; endl &lt;&lt; endl;

            <a class="code" href="classopenrj_1_1stl_1_1memory__database.html">openrj::stl::memory_database</a>    db(&amp;contents[0], <span class="keyword">sizeof</span>(contents), flags);

<span class="preprocessor">#else </span><span class="comment">/* ? USE_MEMORY_DATABASE */</span>

            <span class="comment">// 1. Create a database instance on file, using openrj::stl::file_database</span>

            cout &lt;&lt; endl &lt;&lt; <span class="stringliteral">"1. Create a database instance on file, using openrj::stl::file_database"</span> &lt;&lt; endl &lt;&lt; endl;

            <a class="code" href="classopenrj_1_1stl_1_1file__database.html">openrj::stl::file_database</a>      db(jarName, flags);

<span class="preprocessor">#endif </span><span class="comment">/* USE_MEMORY_DATABASE */</span>

            <span class="comment">// 2. Display database characteristics</span>

            cout &lt;&lt; endl &lt;&lt; <span class="stringliteral">"2. Display database characteristics:"</span> &lt;&lt; endl &lt;&lt; endl;

<span class="preprocessor">#ifdef USE_MEMORY_DATABASE</span>
<span class="preprocessor"></span>            cout    &lt;&lt; <span class="stringliteral">"  Database has "</span> 
<span class="preprocessor">#else </span><span class="comment">/* ? USE_MEMORY_DATABASE */</span>
            cout    &lt;&lt; <span class="stringliteral">"  Database \""</span> &lt;&lt; jarName &lt;&lt; <span class="stringliteral">"\" has "</span> 
<span class="preprocessor">#endif </span><span class="comment">/* USE_MEMORY_DATABASE */</span>
                    &lt;&lt; db.num_lines() &lt;&lt; <span class="stringliteral">" lines in "</span> 
                    &lt;&lt; db.num_fields() &lt;&lt; <span class="stringliteral">" fields in "</span>
                    &lt;&lt; db.num_records() &lt;&lt; <span class="stringliteral">" records"</span>
                    &lt;&lt; endl;

            <span class="comment">// 3. Enumerate the contents using subscript operators</span>

            cout &lt;&lt; endl &lt;&lt; <span class="stringliteral">"3. Enumerate records and their fields using subscript operators:"</span> &lt;&lt; endl &lt;&lt; endl;

            { <span class="keywordflow">for</span>(size_t iRecord = 0; iRecord &lt; db.size(); ++iRecord)
            {
                <a class="code" href="classopenrj_1_1stl_1_1record.html">openrj::stl::record</a> record(db[iRecord]);

                cout    &lt;&lt; <span class="stringliteral">"  record-#"</span> &lt;&lt; iRecord
                        &lt;&lt; <span class="stringliteral">" "</span> &lt;&lt; record.comment() &lt;&lt; <span class="stringliteral">" "</span>
                        &lt;&lt; <span class="stringliteral">" ("</span> &lt;&lt; record.size() &lt;&lt; <span class="stringliteral">" fields)"</span>
                        &lt;&lt; endl;

                <span class="keywordflow">for</span>(size_t iField = 0; iField &lt; record.size(); ++iField)
                {
                    <a class="code" href="classopenrj_1_1stl_1_1field.html">openrj::stl::field</a>  field(record[iField]);
                    std::string         name    =   field.name();
                    std::string         value   =   field.value();

                    cout &lt;&lt; <span class="stringliteral">"    field-#"</span> &lt;&lt; iField &lt;&lt; field &lt;&lt; endl;
                }
            }}

            <span class="comment">// 4. Enumerate the contents using begin()/end() methods</span>

            cout &lt;&lt; endl &lt;&lt; <span class="stringliteral">"4. Enumerate records and their fields using begin()/end() methods:"</span> &lt;&lt; endl &lt;&lt; endl;

            {   openrj::stl::database::const_iterator   b   =   db.begin();
                openrj::stl::database::const_iterator   e   =   db.end();

                <span class="keywordflow">for</span>(size_t iRecord = 0; b != e; ++b, ++iRecord)
            {
                <a class="code" href="classopenrj_1_1stl_1_1record.html">openrj::stl::record</a> record(*b);

                cout    &lt;&lt; <span class="stringliteral">"  record-#"</span> &lt;&lt; iRecord
                        &lt;&lt; <span class="stringliteral">" "</span> &lt;&lt; record.comment() &lt;&lt; <span class="stringliteral">" "</span>
                        &lt;&lt; <span class="stringliteral">" ("</span> &lt;&lt; record.size() &lt;&lt; <span class="stringliteral">" fields)"</span>
                        &lt;&lt; endl;

                <span class="keywordflow">if</span>(record.has_field(<span class="stringliteral">"Name"</span>))
                {
                    <a class="code" href="namespaceopenrj_1_1stl.html#a1">openrj::stl::string_t</a>   value       =   record[<span class="stringliteral">"Name"</span>];

                    cout &lt;&lt; <span class="stringliteral">"    This record has a \"Name\" field, whose value is "</span> &lt;&lt; value &lt;&lt; endl;

                    size_t                  numNames    =   record.count_fields(<span class="stringliteral">"Name"</span>);

                    STLSOFT_SUPPRESS_UNUSED(numNames);
                }

                {   <a class="code" href="classopenrj_1_1stl_1_1record_1_1const__iterator.html">openrj::stl::record::const_iterator</a> b   =   record.begin();
                    <a class="code" href="classopenrj_1_1stl_1_1record_1_1const__iterator.html">openrj::stl::record::const_iterator</a> e   =   record.end();

                    <span class="keywordflow">for</span>(size_t iField = 0; b != e; ++b, ++iField)
                    {
                        <a class="code" href="classopenrj_1_1stl_1_1field.html">openrj::stl::field</a>  field(*b);
                        std::string         name    =   field.name();
                        std::string         value   =   field.value();

                        cout &lt;&lt; <span class="stringliteral">"    field-#"</span> &lt;&lt; iField &lt;&lt; <span class="stringliteral">" "</span> &lt;&lt; field &lt;&lt; endl;
                }}
            }}

<span class="preprocessor">#ifdef __STLSOFT_CF_BIDIRECTIONAL_ITERATOR_SUPPORT</span>
<span class="preprocessor"></span>            <span class="comment">// 5. Enumerate the contents in reverse using rbegin()/rend() methods</span>

            cout &lt;&lt; endl &lt;&lt; <span class="stringliteral">"5. Enumerate the contents in reverse using rbegin()/rend() methods:"</span> &lt;&lt; endl &lt;&lt; endl;

            {   <a class="code" href="classopenrj_1_1stl_1_1database__base.html#openrj_1_1stl_1_1memory__databasew9">openrj::stl::database::const_reverse_iterator</a>   b   =   db.rbegin();
                <a class="code" href="classopenrj_1_1stl_1_1database__base.html#openrj_1_1stl_1_1memory__databasew9">openrj::stl::database::const_reverse_iterator</a>   e   =   db.rend();

                <span class="keywordflow">for</span>(size_t iRecord = 0; b != e; ++b, ++iRecord)
            {
                <a class="code" href="classopenrj_1_1stl_1_1record.html">openrj::stl::record</a> record(*b);

                cout    &lt;&lt; <span class="stringliteral">"  record-#"</span> &lt;&lt; iRecord
                        &lt;&lt; <span class="stringliteral">" "</span> &lt;&lt; record.comment() &lt;&lt; <span class="stringliteral">" "</span>
                        &lt;&lt; <span class="stringliteral">" ("</span> &lt;&lt; record.size() &lt;&lt; <span class="stringliteral">" fields)"</span>
                        &lt;&lt; endl;

                <span class="keywordflow">if</span>(record.has_field(<span class="stringliteral">"Name"</span>))
                {
                    <a class="code" href="namespaceopenrj_1_1stl.html#a1">openrj::stl::string_t</a>   value       =   record[<span class="stringliteral">"Name"</span>];

                    cout &lt;&lt; <span class="stringliteral">"    This record has a \"Name\" field, whose value is "</span> &lt;&lt; value &lt;&lt; endl;

                    size_t                  numNames    =   record.count_fields(<span class="stringliteral">"Name"</span>);

                    STLSOFT_SUPPRESS_UNUSED(numNames);
                }

                {   <a class="code" href="classopenrj_1_1stl_1_1record.html#openrj_1_1stl_1_1recordw5">openrj::stl::record::const_reverse_iterator</a> b   =   record.rbegin();
                    <a class="code" href="classopenrj_1_1stl_1_1record.html#openrj_1_1stl_1_1recordw5">openrj::stl::record::const_reverse_iterator</a> e   =   record.rend();

                    <span class="keywordflow">for</span>(size_t iField = 0; b != e; ++b, ++iField)
                    {
                        <a class="code" href="classopenrj_1_1stl_1_1field.html">openrj::stl::field</a>  field(*b);
                        std::string         name    =   field.name();
                        std::string         value   =   field.value();

                        cout &lt;&lt; <span class="stringliteral">"    field-#"</span> &lt;&lt; iField &lt;&lt; <span class="stringliteral">" "</span> &lt;&lt; field &lt;&lt; endl;
                }}
            }}
<span class="preprocessor">#endif </span><span class="comment">/* __STLSOFT_CF_BIDIRECTIONAL_ITERATOR_SUPPORT */</span>

<span class="preprocessor">#ifndef OPENRJ_STL_DATABASE_NO_FIELD_ITERATORS</span>
<span class="preprocessor"></span>            <span class="comment">// 6. Enumerate all fields in the database using begin()/end() methods</span>

            cout &lt;&lt; endl &lt;&lt; <span class="stringliteral">"6. Enumerate all fields in the database using begin()/end() methods:"</span> &lt;&lt; endl &lt;&lt; endl;

            std::copy(db.fields_begin(), db.fields_end(), std::ostream_iterator&lt;openrj::stl::field&gt;(std::cout, <span class="stringliteral">"\n"</span>));

<span class="preprocessor"># ifdef __STLSOFT_CF_BIDIRECTIONAL_ITERATOR_SUPPORT</span>
<span class="preprocessor"></span>            <span class="comment">// 7. Enumerate all fields in the database in reverse using rbegin()/rend() methods</span>

            cout &lt;&lt; endl &lt;&lt; <span class="stringliteral">"7. Enumerate all fields in the database in reverse using rbegin()/rend() methods:"</span> &lt;&lt; endl &lt;&lt; endl;

            cout &lt;&lt; endl &lt;&lt; <span class="stringliteral">"All fields (in reverse order):"</span> &lt;&lt; endl;
            std::copy(db.fields_rbegin(), db.fields_rend(), std::ostream_iterator&lt;openrj::stl::field&gt;(std::cout, <span class="stringliteral">"\n"</span>));
<span class="preprocessor"># endif </span><span class="comment">/* __STLSOFT_CF_BIDIRECTIONAL_ITERATOR_SUPPORT */</span>
<span class="preprocessor">#endif </span><span class="comment">/* !OPENRJ_STL_DATABASE_NO_FIELD_ITERATORS */</span>

        }
<span class="preprocessor">#ifdef USE_STD_EXCEPTION_ONLY</span>
<span class="preprocessor"></span>        <span class="keywordflow">catch</span>(std::exception &amp;x)
        {
            cerr &lt;&lt; <span class="stringliteral">"Failed to open database: "</span> &lt;&lt; x.what() &lt;&lt; endl;
        }
<span class="preprocessor">#else </span><span class="comment">/* ? USE_STD_EXCEPTION_ONLY */</span>
        <span class="keywordflow">catch</span>(<a class="code" href="classopenrj_1_1stl_1_1database__exception.html">openrj::stl::database_exception</a> &amp;x)
        {
            <a class="code" href="namespaceopenrj.html#a64">openrj::ORJRC</a>   rc = x.rc();

            <span class="keywordflow">if</span>(0 != rc)
            {
                <span class="keywordflow">switch</span>(rc)
                {
                    <span class="keywordflow">case</span>    <a class="code" href="namespaceopenrj.html#a64a10">openrj::ORJ_RC_CANNOTOPENJARFILE</a>:
                        cout &lt;&lt; <span class="stringliteral">"Cannot open file: "</span> &lt;&lt; jarName &lt;&lt; <span class="stringliteral">""</span> &lt;&lt; endl;
                        <span class="keywordflow">break</span>;
                    <span class="keywordflow">case</span>    <a class="code" href="namespaceopenrj.html#a64a14">openrj::ORJ_RC_PARSEERROR</a>:
                        cout    &lt;&lt; <span class="stringliteral">"Error in "</span> &lt;&lt; jarName
                                &lt;&lt; <span class="stringliteral">", at line "</span> &lt;&lt; x.error().invalidLine
                                &lt;&lt; <span class="stringliteral">", column "</span> &lt;&lt; x.error().invalidColumn
                                &lt;&lt; <span class="stringliteral">"; "</span> &lt;&lt; <a class="code" href="group__group__openrj__stringaccessshims.html#ga1">stlsoft::c_str_ptr</a>(x.error().parseError)
                                &lt;&lt; <span class="stringliteral">""</span> &lt;&lt; endl;
                        <span class="keywordflow">break</span>;
                    <span class="keywordflow">default</span>:
                        <span class="keywordflow">break</span>;
                }
            }
        }
<span class="preprocessor">#endif </span><span class="comment">/* USE_STD_EXCEPTION_ONLY */</span>
    }

    STLSOFT_SUPPRESS_UNUSED(execute_unittest);

    <span class="keywordflow">return</span> EXIT_SUCCESS;
}

<span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])
{
<span class="preprocessor">#if 0</span>
<span class="preprocessor"></span>    <span class="keywordflow">for</span>(;;) {};
<span class="preprocessor">#endif </span><span class="comment">/* 0 */</span>

    <span class="keywordflow">try</span>
    {
        <span class="keywordflow">return</span> main_(argc, argv);
    }
    <span class="keywordflow">catch</span>(std::exception &amp;x)
    {
        cerr &lt;&lt; <span class="stringliteral">"Unhandled error: "</span> &lt;&lt; x.what() &lt;&lt; endl;
    }
    <span class="keywordflow">catch</span>(...)
    {
        cerr &lt;&lt; <span class="stringliteral">"Unhandled unknown error"</span> &lt;&lt; endl;
    }

    <span class="keywordflow">return</span> EXIT_FAILURE;
}

<span class="comment">/* ////////////////////////////////////////////////////////////////////////// */</span>

<span class="preprocessor">#if defined(__GNUC__)</span>
<span class="preprocessor"></span><span class="preprocessor"># ifdef alloca</span>
<span class="preprocessor"></span><span class="preprocessor">#  undef alloca</span>
<span class="preprocessor"></span><span class="preprocessor"># endif </span><span class="comment">/* !alloca */</span>
<span class="preprocessor"># define alloca             __builtin_alloca</span>
<span class="preprocessor"></span><span class="preprocessor">#elif defined(WIN32)</span>
<span class="preprocessor"></span><span class="preprocessor"># include &lt;malloc.h&gt;</span>
<span class="preprocessor"># ifndef alloca</span>
<span class="preprocessor"></span><span class="preprocessor">#  define alloca            _alloca</span>
<span class="preprocessor"></span><span class="preprocessor"># endif </span><span class="comment">/* !alloca */</span>
<span class="preprocessor">#else </span><span class="comment">/* ? OS */</span>
<span class="preprocessor"># include &lt;alloca.h&gt;</span>
<span class="preprocessor">#endif </span><span class="comment">/* OS */</span>

<span class="keyword">static</span> <span class="keywordtype">void</span> usage(<span class="keywordtype">int</span> bExit, <span class="keywordtype">char</span> <span class="keyword">const</span> *reason, <span class="keywordtype">int</span> invalidArg, <span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])
{
    <span class="keywordtype">char</span>    *EXE_NAME   =   strcpy(static_cast&lt;char*&gt;(alloca(1 + strlen(argv[0]))), argv[0]);
    <span class="keywordtype">char</span>    *p;

    <span class="keywordflow">if</span>(NULL != (p = strrchr(EXE_NAME, <span class="charliteral">'\\'</span>)))
    {
        0[(EXE_NAME = p + 1) - 1] = <span class="charliteral">'\0'</span>;
    }

    <span class="keywordflow">if</span>(NULL != (p = strrchr(EXE_NAME, <span class="charliteral">'/'</span>)))
    {
        0[(EXE_NAME = p + 1) - 1] = <span class="charliteral">'\0'</span>;
    }

    cerr &lt;&lt; <span class="stringliteral">""</span> &lt;&lt; endl;
    cerr &lt;&lt; <span class="stringliteral">"  Open-RJ STL test program: "</span> &lt;&lt; EXE_NAME &lt;&lt; endl;;
    cerr &lt;&lt; <span class="stringliteral">""</span> &lt;&lt; endl;

    stlsoft_assert(invalidArg &lt; argc);

    <span class="keywordflow">if</span>(NULL != reason)
    {
        cerr &lt;&lt; <span class="stringliteral">"  Error: "</span> &lt;&lt; reason &lt;&lt; <span class="stringliteral">""</span> &lt;&lt; endl;
        cerr &lt;&lt; <span class="stringliteral">""</span> &lt;&lt; endl;
    }

    <span class="keywordflow">if</span>(0 &lt; invalidArg)
    {
        cerr &lt;&lt; <span class="stringliteral">"  First invalid argument #"</span> &lt;&lt; invalidArg &lt;&lt; <span class="stringliteral">": "</span> &lt;&lt; argv[invalidArg] &lt;&lt; endl;
        cerr &lt;&lt; <span class="stringliteral">"  Arguments were (first bad marked *):"</span> &lt;&lt; endl &lt;&lt; endl;
        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 1; i &lt; argc; ++i)
        {
            cerr &lt;&lt; <span class="stringliteral">"  "</span> &lt;&lt; ((i == invalidArg) ? <span class="stringliteral">"* "</span> : <span class="stringliteral">"  "</span>) &lt;&lt; argv[i] &lt;&lt; endl;
        }
        cerr &lt;&lt; <span class="stringliteral">""</span> &lt;&lt; endl;
    }

    cerr &lt;&lt; <span class="stringliteral">"  USAGE 1: "</span> &lt;&lt; EXE_NAME &lt;&lt; <span class="stringliteral">" [-o] [-s] &lt;database&gt;"</span> &lt;&lt; endl;
    cerr &lt;&lt; <span class="stringliteral">""</span> &lt;&lt; endl;
    cerr &lt;&lt; <span class="stringliteral">"    -o            -   orders the fields within each record"</span> &lt;&lt; endl;
    cerr &lt;&lt; <span class="stringliteral">"    -s            -   elide blank records from the database"</span> &lt;&lt; endl;
    cerr &lt;&lt; <span class="stringliteral">"    &lt;database&gt;    -   the Open-RJ database file"</span> &lt;&lt; endl;
    cerr &lt;&lt; <span class="stringliteral">""</span> &lt;&lt; endl;
    cerr &lt;&lt; <span class="stringliteral">"    Converts the &lt;input-file&gt; to the &lt;output-file&gt; by either"</span> &lt;&lt; endl;
    cerr &lt;&lt; <span class="stringliteral">"    Base-64 encoding (-e) or Base-64 decoding (-d)"</span> &lt;&lt; endl;
    cerr &lt;&lt; <span class="stringliteral">""</span> &lt;&lt; endl;
    cerr &lt;&lt; <span class="stringliteral">"  USAGE 2: "</span> &lt;&lt; EXE_NAME &lt;&lt; <span class="stringliteral">" --unittest"</span> &lt;&lt; endl;
    cerr &lt;&lt; <span class="stringliteral">""</span> &lt;&lt; endl;
    cerr &lt;&lt; <span class="stringliteral">"    Runs internal tests, returning 0 if all succeed, non-0 otherwise"</span> &lt;&lt; endl;
    cerr &lt;&lt; <span class="stringliteral">""</span> &lt;&lt; endl;
    cerr &lt;&lt; <span class="stringliteral">"  USAGE 3: "</span> &lt;&lt; EXE_NAME &lt;&lt; <span class="stringliteral">" -?"</span> &lt;&lt; endl;
    cerr &lt;&lt; <span class="stringliteral">""</span> &lt;&lt; endl;
    cerr &lt;&lt; <span class="stringliteral">"    Displays this help"</span> &lt;&lt; endl;
    cerr &lt;&lt; <span class="stringliteral">""</span> &lt;&lt; endl;

    <span class="keywordflow">if</span>(bExit)
    {
        exit(EXIT_FAILURE);
    }
}

<span class="keyword">static</span> <span class="keywordtype">int</span> execute_unittest(<a class="code" href="classopenrj_1_1stl_1_1database__base.html">openrj::stl::database_base</a> <span class="keyword">const</span> &amp;database)
{
    <span class="comment">/* 1. Check that the database thinks it has the same number of total</span>
<span class="comment">     * fields as the total of each record</span>
<span class="comment">     */</span>
    size_t  numFields1  =   database.<a class="code" href="classopenrj_1_1stl_1_1database__base.html#openrj_1_1stl_1_1memory__databasea4">num_fields</a>();
    size_t  numFields2  =   0;

    { <span class="keywordflow">for</span>(size_t i = 0; i &lt; database.<a class="code" href="classopenrj_1_1stl_1_1database__base.html#openrj_1_1stl_1_1memory__databasea5">num_records</a>(); ++i)
    {
        numFields2 += database[i].<a class="code" href="classopenrj_1_1stl_1_1database__base.html#openrj_1_1stl_1_1memory__databasea6">size</a>();
    }}

    <span class="keywordflow">if</span>(numFields1 != numFields2)
    {
        fprintf(stderr, <span class="stringliteral">"DatabaseBase::GetNumFields(): %ld; n x Record::GetNumFields(): %ld\n"</span>, static_cast&lt;long&gt;(numFields1), static_cast&lt;long&gt;(numFields2));

        <span class="keywordflow">return</span> 1;
    }

    <span class="comment">/* NOTE: Other tests not yet implemented */</span>

    <span class="keywordflow">return</span> 0;
}

<span class="keyword">static</span> <span class="keywordtype">int</span> run_unittests()
{
    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span>   contents[] =

        <span class="stringliteral">"%% Sample Open-RJ database - Cats and Dogs\n"</span>
        <span class="stringliteral">"%% Created:   28th September 2004\n"</span>
        <span class="stringliteral">"%% Updated:   29th September 2004\n"</span>
        <span class="stringliteral">"Name:      Barney\n"</span>
        <span class="stringliteral">"Species:   Dog\n"</span>
        <span class="stringliteral">"Breed:     Bijon \\\n"</span>
        <span class="stringliteral">"           Frieze\n"</span>
        <span class="stringliteral">"%%\n"</span>
        <span class="stringliteral">"Name:      Elsa\n"</span>
        <span class="stringliteral">"Species:   Dog\n"</span>
        <span class="stringliteral">"Breed:     Mixed\n"</span>
        <span class="stringliteral">"%%\n"</span>
        <span class="stringliteral">"Name:      Fluffy Kitten\n"</span>
        <span class="stringliteral">"Species:   Cat\n"</span>
        <span class="stringliteral">"%%\n"</span>
        <span class="stringliteral">"Name:      Moet\n"</span>
        <span class="stringliteral">"Species:   Dog\n"</span>
        <span class="stringliteral">"Breed:     Boxer\n"</span>
        <span class="stringliteral">"%%\n"</span>
        <span class="stringliteral">"Name:      Rebel\n"</span>
        <span class="stringliteral">"Species:   Dog\n"</span>
        <span class="stringliteral">"Breed:     German \\\n"</span>
        <span class="stringliteral">"           Shepherd\n"</span>
        <span class="stringliteral">"%%\n"</span>
<span class="preprocessor">#if !defined(__GNUC__)</span>
<span class="preprocessor"></span>        <span class="stringliteral">"Name:      Pepper\n"</span>
        <span class="stringliteral">"Species:   Dog\n"</span>
        <span class="stringliteral">"Breed:     Border Collie\n"</span>
        <span class="stringliteral">"%%\n"</span>
        <span class="stringliteral">"Name:      Samson\n"</span>
        <span class="stringliteral">"Species:   Dog\n"</span>
        <span class="stringliteral">"Breed:     Ridgeback\n"</span>
        <span class="stringliteral">"%%\n"</span>
        <span class="stringliteral">"Name:      Sheltie\n"</span>
        <span class="stringliteral">"Species:   Dog\n"</span>
        <span class="stringliteral">"Breed:     Shetland \\\n"</span>
        <span class="stringliteral">"           Sheepdog\n"</span>
        <span class="stringliteral">"%%\n"</span>
<span class="preprocessor">#endif </span><span class="comment">/* compiler */</span>
        <span class="stringliteral">"Name:      Sparky\n"</span>
        <span class="stringliteral">"Species:   Cat\n"</span>
        <span class="stringliteral">"%%\n"</span>;
<span class="preprocessor">#if !defined(__GNUC__)</span>
<span class="preprocessor"></span>    <span class="keyword">static</span> <span class="keyword">const</span> size_t NUM_RECORDS =   12;
    <span class="keyword">static</span> <span class="keyword">const</span> size_t NUM_FIELDS  =   25;
<span class="preprocessor">#else </span><span class="comment">/* ?  compiler */</span>
    <span class="keyword">static</span> <span class="keyword">const</span> size_t NUM_RECORDS =   9;
    <span class="keyword">static</span> <span class="keyword">const</span> size_t NUM_FIELDS  =   16;
<span class="preprocessor">#endif </span><span class="comment">/* compiler */</span>

    <span class="comment">/* 1. Test that *not* eliding blanks gives the right number of records */</span>
    <span class="keywordflow">try</span>
    {
        <a class="code" href="classopenrj_1_1stl_1_1memory__database.html">openrj::stl::memory_database</a>    <a class="code" href="namespaceopenrj_1_1stl.html#a0">database</a>(&amp;contents[0], <span class="keyword">sizeof</span>(contents), 0);

        <span class="keywordtype">int</span> iRet = 0;

        <span class="keywordflow">if</span>(NUM_RECORDS != database.<a class="code" href="classopenrj_1_1stl_1_1database__base.html#openrj_1_1stl_1_1memory__databasea5">num_records</a>())
        {
            fprintf(stderr, <span class="stringliteral">"Incorrect number of records\n"</span>);

            iRet = 1;
        }
        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(NUM_FIELDS != database.<a class="code" href="classopenrj_1_1stl_1_1database__base.html#openrj_1_1stl_1_1memory__databasea4">num_fields</a>())
        {
            fprintf(stderr, <span class="stringliteral">"Incorrect number of fields\n"</span>);

            iRet = 1;
        }
        <span class="keywordflow">else</span>
        {
            <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span>    NUM_TESTS   =   1000;
            <span class="keywordtype">int</span>                 i;

            <span class="keywordflow">for</span>(i = 0; i &lt; NUM_TESTS; ++i)
            {
                iRet = execute_unittest(database);

                <span class="keywordflow">if</span>(0 != iRet)
                {
                    <span class="keywordflow">break</span>;
                }
            }

            <span class="keywordflow">if</span>(0 == iRet)
            {
                fprintf(stderr, <span class="stringliteral">"%d tests succeeded\n"</span>, NUM_TESTS);
            }
            <span class="keywordflow">else</span>
            {
                fprintf(stderr, <span class="stringliteral">"Test #%d failed\n"</span>, i);
            }
        }

        <span class="keywordflow">return</span> (0 == iRet) ? EXIT_SUCCESS : EXIT_FAILURE;
    }
    <span class="keywordflow">catch</span>(std::exception &amp;x)
    {
        cout &lt;&lt; <span class="stringliteral">"Failed: "</span> &lt;&lt; x.what() &lt;&lt; endl;

        <span class="keywordflow">return</span> EXIT_FAILURE;
    }
}

<span class="comment">/* /////////////////////////////////////////////////////////////////////////////</span>
<span class="comment"> * end of file</span>
<span class="comment"> */</span>
</pre></div> <table width = "100%">
 <tr>
  <td width = "100%">
   <hr width = "100%">
  </td>
 </tr>
 <tr>
  <td align = "center" valign = "middle">
   <font size = "-1">
    <a href = "http://openrj.org/"><b>Open-RJ</b></a>
    Library documentation 
    <a href = "http://synesis.com.au/"> Synesis Software Pty Ltd, 2004-2005</a>
   </font>
  </td>
 </tr>
</table>
